namespace: ArloRecordings
operation:
  name: Arlo
  inputs:
    - rpaAPIuser
    - rpaAPIpass
  python_action:
    use_jython: false
    script: "def execute(rpaAPIuser,rpaAPIpass):\r\n    ### ARLO Library ###\r\n    \r\n    \"\"\"\r\n    Copyright 2016 Jeffrey D. Walter\r\n    \r\n    Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    you may not use this file except in compliance with the License.\r\n    You may obtain a copy of the License at\r\n    \r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n    \r\n    Unless required by applicable law or agreed to in writing, software\r\n    distributed under the License is distributed on an \"AS ISBASIS,\r\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    See the License for the specific language governing permissions and\r\n    limitations under the License.\r\n    \"\"\"\r\n    \r\n    # 14 Sep 2016, Len Shustek: Added Logout()\r\n    # 17 Jul 2017, Andreas Jakl: Port to Python 3 (https://www.andreasjakl.com/using-netgear-arlo-security-cameras-for-periodic-recording/)\r\n    \r\n    # Import helper classes that are part of the ARLO library\r\n    import queue as queue\r\n    \r\n    \r\n    # Import all of the other stuff.\r\n    from six import string_types, text_type\r\n    from datetime import datetime\r\n    \r\n    import base64\r\n    import calendar\r\n    import json\r\n    #import logging\r\n    import math\r\n    import os\r\n    import pickle\r\n    import random\r\n    import re\r\n    import signal\r\n    import time\r\n    import requests\r\n    from requests.exceptions import HTTPError\r\n    import monotonic\r\n    import sseclient\r\n    import threading\r\n    import sys\r\n    \r\n    from google_auth_oauthlib.flow import InstalledAppFlow\r\n    from googleapiclient.discovery import build\r\n    \r\n    #logging.basicConfig(level=logging.DEBUG,format='[%(levelname)s] (%(threadName)-10s) %(message)s',)\r\n    \r\n    ##\r\n    # Copyright 2016 Jeffrey D. Walter\r\n    #\r\n    # Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    # you may not use this file except in compliance with the License.\r\n    # You may obtain a copy of the License at\r\n    #\r\n    #    http://www.apache.org/licenses/LICENSE-2.0\r\n    #\r\n    # Unless required by applicable law or agreed to in writing, software\r\n    # distributed under the License is distributed on an \"AS IS\" BASIS,\r\n    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    # See the License for the specific language governing permissions and\r\n    # limitations under the License.\r\n    ##\r\n    # TODO: There's a lot more refactoring that could/should be done to abstract out the arlo-specific implementation details.\r\n    \r\n    class EventStream(object):\r\n        \"\"\"This class provides a queue-based EventStream object.\"\"\"\r\n        def __init__(self, event_handler, heartbeat_handler, args):\r\n            self.event_handler = event_handler\r\n            self.connected = False\r\n            self.registered = False\r\n            self.queue = queue.Queue()\r\n            self.heartbeat_stop_event = threading.Event()\r\n            self.event_stream_stop_event = threading.Event()\r\n            self.arlo = args[0]\r\n            self.heartbeat_handler = heartbeat_handler\r\n    \r\n        def __del__(self):\r\n            self.Disconnect()\r\n    \r\n        def Get(self, block=True, timeout=None):\r\n            if sys.version[0] == '2' and block:\r\n                if timeout:\r\n                    timeout += monotonic.monotonic()\r\n                # If timeout is None, then just pick some arbitrarily large # for the timeout value.\r\n                else:\r\n                    timeout = 1000000 + monotonic.monotonic()\r\n    \r\n                while True:\r\n                    try:\r\n                        # Allow check for Ctrl-C every second\r\n                        item = self.queue.get(timeout=min(1, timeout - monotonic.monotonic()))\r\n                        self.queue.task_done()\r\n                        return item\r\n                    except queue.Empty:\r\n                        if monotonic.monotonic() > timeout:\r\n                            return None\r\n                        else:\r\n                            pass\r\n            else:\r\n                try:\r\n                    item = self.queue.get(block=block, timeout=timeout)\r\n                    self.queue.task_done()\r\n                    return item\r\n                except queue.Empty as e:\r\n                    return None\r\n                except Exception as e:\r\n                    return None\r\n    \r\n        def Start(self):\r\n            try:\r\n                event_stream = sseclient.SSEClient('https://myapi.arlo.com/hmsweb/client/subscribe?token='+self.arlo.request.session.headers.get('Authorization').decode(), session=self.arlo.request.session)\r\n                self.event_stream_thread = threading.Thread(name=\"EventStream\", target=self.event_handler, args=(self.arlo, event_stream, self.event_stream_stop_event, ))\r\n                self.event_stream_thread.setDaemon(True)\r\n                self.event_stream_thread.start()\r\n            except Exception as e:\r\n                raise Exception('Failed to start eventstream thread: {0}'.format(e))\r\n    \r\n    \r\n            return self\r\n    \r\n        def Connect(self):\r\n            self.connected = True\r\n    \r\n        def Disconnect(self):\r\n            self.connected = False\r\n            self.Unregister()\r\n    \r\n        def Register(self):\r\n            try:\r\n                self.heartbeat_thread = threading.Thread(name='HeartbeatThread', target=self.heartbeat_handler, args=(self.arlo, self.heartbeat_stop_event, ))\r\n                self.heartbeat_thread.setDaemon(True)\r\n                self.heartbeat_thread.start()\r\n                self.registered = True\r\n            except Exception as e:\r\n                raise Exception('Failed to start to heartbeat thread: {0}'.format(e))\r\n    \r\n        def Unregister(self):\r\n            self.registered = False\r\n    \r\n            if self.queue:\r\n                self.queue.put(None)\r\n    \r\n            self.event_stream_stop_event.set()\r\n            self.heartbeat_stop_event.set()\r\n    \r\n            if self.event_stream_thread != threading.current_thread():\r\n                self.event_stream_thread.join()\r\n    \r\n            if self.heartbeat_thread != threading.current_thread():\r\n                self.heartbeat_thread.join()\r\n    \r\n    \r\n    ##\r\n    # Copyright 2016 Jeffrey D. Walter\r\n    #\r\n    # Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    # you may not use this file except in compliance with the License.\r\n    # You may obtain a copy of the License at\r\n    #\r\n    #    http://www.apache.org/licenses/LICENSE-2.0\r\n    #\r\n    # Unless required by applicable law or agreed to in writing, software\r\n    # distributed under the License is distributed on an \"AS IS\" BASIS,\r\n    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    # See the License for the specific language governing permissions and\r\n    # limitations under the License.\r\n    ##\r\n    \r\n    #from requests_toolbelt.utils import dump\r\n    #def print_raw_http(response):\r\n    #    data = dump.dump_all(response, request_prefix=b'', response_prefix=b'')\r\n    #    print('\\n' * 2 + data.decode('utf-8'))\r\n    \r\n    class Request(object):\r\n        \"\"\"HTTP helper class\"\"\"\r\n    \r\n        def __init__(self):\r\n            self.session = requests.Session()\r\n    \r\n        def _request(self, url, method='GET', params={}, headers={}, stream=False, raw=False):\r\n    \r\n            ## uncomment for debug logging\r\n            \"\"\"\r\n            import logging\r\n            import http.client\r\n            http.client.HTTPConnection.debuglevel = 1\r\n            logging.basicConfig()\r\n            logging.getLogger().setLevel(logging.DEBUG)\r\n            req_log = logging.getLogger('requests.packages.urllib3')\r\n            req_log.setLevel(logging.DEBUG)\r\n            req_log.propagate = True\r\n            \"\"\"\r\n    \r\n            if method == 'GET':\r\n                #print('COOKIES: ', self.session.cookies.get_dict())\r\n                r = self.session.get(url, params=params, headers=headers, stream=stream)\r\n                r.raise_for_status()\r\n                if stream is True:\r\n                    return r\r\n            elif method == 'PUT':\r\n                r = self.session.put(url, json=params, headers=headers)\r\n                r.raise_for_status()\r\n            elif method == 'POST':\r\n                r = self.session.post(url, json=params, headers=headers)\r\n                r.raise_for_status()\r\n            elif method == 'OPTIONS':\r\n                r = self.session.options(url, headers=headers)\r\n                r.raise_for_status()\r\n                return\r\n    \r\n            body = r.json()\r\n    \r\n            if raw:\r\n                return body\r\n            else:\r\n                if ('success' in body and body['success'] == True) or ('meta' in body and body['meta']['code'] == 200):\r\n                    if 'data' in body:\r\n                        return body['data']\r\n                else:\r\n                    raise HTTPError('Request ({0} {1}) failed: {2}'.format(method, url, r.json()), response=r)\r\n    \r\n        def get(self, url, params={}, headers={}, stream=False, raw=False):\r\n            return self._request(url, 'GET', params=params, headers=headers, stream=stream, raw=raw)\r\n    \r\n        def put(self, url, params={}, headers={}, raw=False):\r\n            return self._request(url, 'PUT', params=params, headers=headers, raw=raw)\r\n    \r\n        def post(self, url, params={}, headers={}, raw=False):\r\n            return self._request(url, 'POST', params=params, headers=headers, raw=raw)\r\n    \r\n        def options(self, url, headers={}, raw=False):\r\n            return self._request(url, 'OPTIONS', headers=headers, raw=raw)\r\n    \r\n    \r\n    class Arlo(object):\r\n        BASE_URL = 'my.arlo.com'\r\n        AUTH_URL = 'ocapi-app.arlo.com'\r\n        TRANSID_PREFIX = 'web'\r\n        def __init__(self, username, password, google_credential_file=None):\r\n    \r\n            # signals only work in main thread\r\n            try:\r\n                signal.signal(signal.SIGINT, self.interrupt_handler)\r\n            except:\r\n                pass\r\n    \r\n            self.event_stream = None\r\n            self.request = None\r\n    \r\n            if google_credential_file:\r\n              self.LoginMFA(username, password, google_credential_file)\r\n            else:\r\n              self.Login(username, password)\r\n    \r\n        def interrupt_handler(self, signum, frame):\r\n            #print(\"Caught Ctrl-C, exiting.\")\r\n            os._exit(1)\r\n    \r\n        def to_timestamp(self, dt):\r\n            if sys.version[0] == '2':\r\n                epoch = datetime.utcfromtimestamp(0)\r\n                return int((dt - epoch).total_seconds() * 1e3)\r\n            else:\r\n                return int(dt.timestamp() * 1e3)\r\n    \r\n        def genTransId(self, trans_type=TRANSID_PREFIX):\r\n            def float2hex(f):\r\n                MAXHEXADECIMALS = 15\r\n                w = f // 1\r\n                d = f % 1\r\n    \r\n                # Do the whole:\r\n                if w == 0: result = '0'\r\n                else: result = ''\r\n                while w:\r\n                    w, r = divmod(w, 16)\r\n                    r = int(r)\r\n                    if r > 9: r = chr(r+55)\r\n                    else: r = str(r)\r\n                    result =  r + result\r\n    \r\n                # And now the part:\r\n                if d == 0: return result\r\n    \r\n                result += '.'\r\n                count = 0\r\n                while d:\r\n                    d = d * 16\r\n                    w, d = divmod(d, 1)\r\n                    w = int(w)\r\n                    if w > 9: w = chr(w+55)\r\n                    else: w = str(w)\r\n                    result +=  w\r\n                    count += 1\r\n                    if count > MAXHEXADECIMALS: break\r\n    \r\n                return result\r\n    \r\n            now = datetime.today()\r\n            return trans_type+\"!\" + float2hex(random.random() * math.pow(2, 32)).lower() + \"!\" + str(int((time.mktime(now.timetuple())*1e3 + now.microsecond/1e3)))\r\n    \r\n        def Login(self, username, password):\r\n            \"\"\"\r\n            This call returns the following:\r\n            {\r\n                \"userId\":\"XXX-XXXXXXX\",\r\n                \"email\":\"user@example.com\",\r\n                \"token\":\"2_5HicFJMXXXXX-S_7IuK2EqOUHXXXXXXXXXXX1CXKWTThgU18Va_XXXXXX5S00hUafv3PV_if_Bl_rhiFsDHYwhxI3CxlVnR5f3q2XXXXXX-Wnt9F7D82uN1f4cXXXXX-FMUsWF_6tMBqwn6DpzOaIB7ciJrnr2QJyKewbQouGM6\",\r\n                \"paymentId\":\"XXXXXXXX\",\r\n                \"authenticated\":1472961381,\r\n                \"accountStatus\":\"registered\",\r\n                \"serialNumber\":\"XXXXXXXXXXXXX\",\r\n                \"countryCode\":\"US\",\r\n                \"tocUpdate\":false,\r\n                \"policyUpdate\":false,\r\n                \"validEmail\":true\r\n            }\r\n            \"\"\"\r\n            self.username = username\r\n            self.password = password\r\n            self.request = Request()\r\n    \r\n            headers = {\r\n                'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NETGEAR/v1 (iOS Vuezone)',\r\n            }\r\n            self.request.options(f'https://{self.AUTH_URL}/api/auth', headers=headers)\r\n    \r\n            headers = {\r\n                'DNT': '1',\r\n                'schemaVersion': '1',\r\n                'Auth-Version': '2',\r\n                'Content-Type': 'application/json; charset=UTF-8',\r\n                'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NETGEAR/v1 (iOS Vuezone)',\r\n                'Origin': f'https://{self.BASE_URL}',\r\n                'Referer': f'https://{self.BASE_URL}/',\r\n                'Source': 'arloCamWeb',\r\n            }\r\n    \r\n            #body = self.request.post(f'https://{self.BASE_URL}/hmsweb/login/v2', {'email': self.username, 'password': self.password}, headers=headers)\r\n            body = self.request.post(\r\n                    f'https://{self.AUTH_URL}/api/auth',\r\n                params={\r\n                    'email': self.username,\r\n                    'password': str(base64.b64encode(self.password.encode('utf-8')), 'utf-8'),\r\n                    'language': 'en',\r\n                    'EnvSource': 'prod'\r\n                },\r\n                headers=headers\r\n            )\r\n            headers['Authorization'] = body['token']\r\n    \r\n            self.request.session.headers.update(headers)\r\n    \r\n            self.user_id = body['userId']\r\n            return body\r\n    \r\n        def LoginMFA(self, username, password, google_credential_file):\r\n            self.username = username\r\n            self.password = password\r\n            self.google_credentials = pickle.load(open(google_credential_file, 'rb'))\r\n            self.request = Request()\r\n            #print(\"Logging into\", username)\r\n            # request MFA token\r\n            request_start_time = int(time.time())\r\n    \r\n            headers = {\r\n                'DNT': '1',\r\n                'schemaVersion': '1',\r\n                'Auth-Version': '2',\r\n                'Content-Type': 'application/json; charset=UTF-8',\r\n                'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NETGEAR/v1 (iOS Vuezone)',\r\n                'Origin': f'https://{self.BASE_URL}',\r\n                'Referer': f'https://{self.BASE_URL}/',\r\n                'Source': 'arloCamWeb',\r\n                'TE': 'Trailers',\r\n            }\r\n    \r\n            # Authenticate\r\n            auth_body = self.request.post(\r\n                    f'https://{self.AUTH_URL}/api/auth',\r\n                params={\r\n                    'email': self.username,\r\n                    'password': str(base64.b64encode(self.password.encode('utf-8')), 'utf-8'),\r\n                    'language': 'en',\r\n                    'EnvSource': 'prod'\r\n                },\r\n                headers=headers,\r\n                raw=True\r\n            )\r\n            self.user_id = auth_body['data']['userId']\r\n            self.request.session.headers.update({'Authorization': base64.b64encode(auth_body['data']['token'].encode('utf-8'))})\r\n    \r\n            # Retrieve email factor id\r\n            factors_body = self.request.get(\r\n                f'https://{self.AUTH_URL}/api/getFactors',\r\n                params={'data': auth_body['data']['issued']},\r\n                headers=headers,\r\n                raw=True\r\n            )\r\n            email_factor_id = next(i for i in factors_body['data']['items'] if i['factorType'] == 'EMAIL')['factorId']\r\n    \r\n            # Start factor auth\r\n            start_auth_body = self.request.post(\r\n                f'https://{self.AUTH_URL}/api/startAuth',\r\n                {'factorId': email_factor_id},\r\n                headers=headers,\r\n                raw=True\r\n            )\r\n            factor_auth_code = start_auth_body['data']['factorAuthCode']\r\n    \r\n            # search for MFA token in latest emails\r\n            pattern = '\\d{6}'\r\n            code = None\r\n            service = build('gmail', 'v1', credentials = self.google_credentials)\r\n    \r\n            for i in range(0, 10):\r\n                time.sleep(5)\r\n    \r\n                messages = service.users().messages().list(\r\n                    userId='me',\r\n                    q=f'from:do_not_reply@arlo.com'\r\n                    # q=f'from:do_not_reply@arlo.com after:{request_start_time}'\r\n                ).execute()\r\n    \r\n                if messages['resultSizeEstimate'] == 0:\r\n                    #print('no matching emails found')\r\n                    continue\r\n    \r\n                # only check the latest message\r\n                message = service.users().messages().get(userId='me', id=messages['messages'][0]['id']).execute()\r\n                search = re.search(pattern, message['snippet'])\r\n                if not search:\r\n                    #print('no matching code in email found')\r\n                    continue\r\n                code = search.group(0)\r\n                #print(code)\r\n                break\r\n    \r\n            \"\"\"\r\n            code = input(\"Enter MFA code:\\n\")\r\n            print(\"CODE\", factor_auth_code)\r\n            \"\"\"\r\n    \r\n            # Complete auth\r\n            finish_auth_body = self.request.post(\r\n                f'https://{self.AUTH_URL}/api/finishAuth',\r\n                {\r\n                    'factorAuthCode': factor_auth_code,\r\n                    'otp': code\r\n                },\r\n                headers=headers,\r\n                raw=True\r\n            )\r\n    \r\n            # Update Authorization code with new code\r\n            headers = {\r\n                'Auth-Version': '2',\r\n                'Authorization': finish_auth_body['data']['token'].encode('utf-8'),\r\n                'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NETGEAR/v1 (iOS Vuezone)',\r\n            }\r\n            self.request.session.headers.update(headers)\r\n            self.BASE_URL = 'myapi.arlo.com'\r\n    \r\n        def Logout(self):\r\n            self.Unsubscribe()\r\n            return self.request.put(f'https://{self.BASE_URL}/hmsweb/logout')\r\n    \r\n        def Subscribe(self, basestation):\r\n            \"\"\"\r\n            Arlo uses the EventStream interface in the browser to do pub/sub style messaging.\r\n            Unfortunately, this appears to be the only way Arlo communicates these messages.\r\n    \r\n            This function makes the initial GET request to /subscribe, which returns the EventStream socket.\r\n            Once we have that socket, the API requires a POST request to /notify with the \"subscriptionsresource.\r\n            This call \"registersthe device (which should be the basestation) so that events will be sent to the EventStream\r\n            when subsequent calls to /notify are made.\r\n    \r\n            Since this interface is asynchronous, and this is a quick and dirty hack to get this working, I'm using a thread\r\n            to listen to the EventStream. This thread puts events into a queue. Some polling is required (see NotifyAndGetResponse()) because\r\n            the event messages aren't guaranteed to be delivered in any specific order, but I wanted to maintain a synchronous style API.\r\n    \r\n            You generally shouldn't need to call Subscribe() directly, although I'm leaving it \"publicfor now.\r\n            \"\"\"\r\n            basestation_id = basestation.get('deviceId')\r\n    \r\n            def Register(self):\r\n                if self.event_stream and self.event_stream.connected and not self.event_stream.registered:\r\n                    self.Notify(basestation, {\"action\":\"set\",\"resource\":\"subscriptions/\"+self.user_id+\"_web\",\"publishResponse\":False,\"properties\":{\"devices\":[basestation_id]}})\r\n                    event = self.event_stream.Get()\r\n                    if event is None or self.event_stream.event_stream_stop_event.is_set():\r\n                        return None\r\n                    elif event:\r\n                        self.event_stream.Register()\r\n                    return event\r\n    \r\n            def QueueEvents(self, event_stream, stop_event):\r\n                for event in event_stream:\r\n                    if event is None or stop_event.is_set():\r\n                        return None\r\n    \r\n                    response = json.loads(event.data)\r\n                    if self.event_stream and self.event_stream.connected:\r\n                        if response.get('action') == 'logout':\r\n                            self.event_stream.Disconnect()\r\n                            return None\r\n                        else:\r\n                            self.event_stream.queue.put(response)\r\n                    elif response.get('status') == 'connected':\r\n                        self.event_stream.Connect()\r\n    \r\n            def Heartbeat(self, stop_event):\r\n                while not stop_event.wait(30.0):\r\n                    try:\r\n                        self.Ping(basestation)\r\n                    except:\r\n                        pass\r\n    \r\n            if not self.event_stream or not self.event_stream.connected:\r\n                self.event_stream = EventStream(QueueEvents, Heartbeat, args=(self, ))\r\n                self.event_stream.Start()\r\n                while not self.event_stream.connected and not self.event_stream.event_stream_stop_event.is_set():\r\n                    time.sleep(0.5)\r\n    \r\n            if not self.event_stream.registered:\r\n                Register(self)\r\n    \r\n        def Unsubscribe(self):\r\n            \"\"\" This method stops the EventStream subscription and removes it from the event_stream collection. \"\"\"\r\n            if self.event_stream and self.event_stream.connected:\r\n                self.request.get(f'https://{self.BASE_URL}/hmsweb/client/unsubscribe')\r\n                self.event_stream.Disconnect()\r\n    \r\n            self.event_stream = None\r\n    \r\n        def Notify(self, basestation, body):\r\n            \"\"\"\r\n            The following are examples of the json you would need to pass in the body of the Notify() call to interact with Arlo:\r\n    \r\n            ##############################################################################################################################\r\n            ##############################################################################################################################\r\n            NOTE: While you can call Notify() directly, responses from these notify calls are sent to the EventStream (see Subscribe()),\r\n            and so it's better to use the Get/Set methods that are implemented using the NotifyAndGetResponse() method.\r\n            ##############################################################################################################################\r\n            ##############################################################################################################################\r\n    \r\n            Set System Mode (Armed, Disarmed) - {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"set\",\"resource\":\"modes\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"active\":\"mode0\"}}\r\n            Set System Mode (Calendar) - {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"set\",\"resource\":\"schedule\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"active\":true}}\r\n            Configure The Schedule (Calendar) - {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"set\",\"resource\":\"schedule\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"schedule\":[{\"modeId\":\"mode0\",\"startTime\":0},{\"modeId\":\"mode2\",\"startTime\":28800000},{\"modeId\":\"mode0\",\"startTime\":64800000},{\"modeId\":\"mode0\",\"startTime\":86400000},{\"modeId\":\"mode2\",\"startTime\":115200000},{\"modeId\":\"mode0\",\"startTime\":151200000},{\"modeId\":\"mode0\",\"startTime\":172800000},{\"modeId\":\"mode2\",\"startTime\":201600000},{\"modeId\":\"mode0\",\"startTime\":237600000},{\"modeId\":\"mode0\",\"startTime\":259200000},{\"modeId\":\"mode2\",\"startTime\":288000000},{\"modeId\":\"mode0\",\"startTime\":324000000},{\"modeId\":\"mode0\",\"startTime\":345600000},{\"modeId\":\"mode2\",\"startTime\":374400000},{\"modeId\":\"mode0\",\"startTime\":410400000},{\"modeId\":\"mode0\",\"startTime\":432000000},{\"modeId\":\"mode0\",\"startTime\":518400000}]}\r\n            Create Mode -\r\n               {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"add\",\"resource\":\"rules\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"name\":\"Record video on Camera 1 if Camera 1 detects motion\",\"id\":\"ruleNew\",\"triggers\":[{\"type\":\"pirMotionActive\",\"deviceId\":\"XXXXXXXXXXXXX\",\"sensitivity\":80}],\"actions\":[{\"deviceId\":\"XXXXXXXXXXXXX\",\"type\":\"recordVideo\",\"stopCondition\":{\"type\":\"timeout\",\"timeout\":15}},{\"type\":\"sendEmailAlert\",\"recipients\":[\"__OWNER_EMAIL__\"]},{\"type\":\"pushNotification\"}]}}\r\n               {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"add\",\"resource\":\"modes\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"name\":\"Test\",\"rules\":[\"rule3\"]}}\r\n            Delete Mode - {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"delete\",\"resource\":\"modes/mode3\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true}\r\n            Camera Off - {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"set\",\"resource\":\"cameras/XXXXXXXXXXXXX\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"privacyActive\":false}}\r\n            Night Vision On - {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"set\",\"resource\":\"cameras/XXXXXXXXXXXXX\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"zoom\":{\"topleftx\":0,\"toplefty\":0,\"bottomrightx\":1280,\"bottomrighty\":720},\"mirror\":true,\"flip\":true,\"nightVisionMode\":1,\"powerSaveMode\":2}}\r\n            Motion Detection Test - {\"from\":\"XXX-XXXXXXX_web\",\"to\":\"XXXXXXXXXXXXX\",\"action\":\"set\",\"resource\":\"cameras/XXXXXXXXXXXXX\",\"transId\":\"web!XXXXXXXX.XXXXXXXXXXXXXXXXXXXX\",\"publishResponse\":true,\"properties\":{\"motionSetupModeEnabled\":true,\"motionSetupModeSensitivity\":80}}\r\n    \r\n            device_id = locations.data.uniqueIds\r\n    \r\n            System Properties: (\"resource\":\"modes\")\r\n              active (string) - Mode Selection (mode2 = All Motion On, mode1 = Armed, mode0 = Disarmed, etc.)\r\n    \r\n            System Properties: (\"resource\":\"schedule\")\r\n              active (bool) - Mode Selection (true = Calendar)\r\n    \r\n            Camera Properties: (\"resource\":\"cameras/{id}\")\r\n              privacyActive (bool) - Camera On/Off\r\n              zoom (topleftx (int), toplefty (int), bottomrightx (int), bottomrighty (int)) - Camera Zoom Level\r\n              mirror (bool) - Mirror Image (left-to-right or right-to-left)\r\n              flip (bool) - Flip Image Vertically\r\n              nightVisionMode (int) - Night Mode Enabled/Disabled (1, 0)\r\n              powerSaveMode (int) - PowerSaver Mode (3 = Best Video, 2 = Optimized, 1 = Best Battery Life)\r\n              motionSetupModeEnabled (bool) - Motion Detection Setup Enabled/Disabled\r\n              motionSetupModeSensitivity (int 0-100) - Motion Detection Sensitivity\r\n            \"\"\"\r\n            basestation_id = basestation.get('deviceId')\r\n    \r\n            body['transId'] = self.genTransId()\r\n            body['from'] = self.user_id+'_web'\r\n            body['to'] = basestation_id\r\n    \r\n            self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/notify/'+body['to'], body, headers={\"xcloudId\":basestation.get('xCloudId')})\r\n            return body.get('transId')\r\n    \r\n        def NotifyAndGetResponse(self, basestation, body, timeout=120):\r\n            basestation_id = basestation.get('deviceId')\r\n    \r\n            self.Subscribe(basestation)\r\n    \r\n            if self.event_stream and self.event_stream.connected and self.event_stream.registered:\r\n                transId = self.Notify(basestation, body)\r\n    \r\n                event = self.event_stream.Get(timeout=timeout)\r\n                if event is None or self.event_stream.event_stream_stop_event.is_set():\r\n                    return None\r\n    \r\n                while self.event_stream.connected and self.event_stream.registered:\r\n                    tid = event.get('transId', '')\r\n                    if tid != transId:\r\n                        if tid.startswith(self.TRANSID_PREFIX):\r\n                            self.event_stream.queue.put(event)\r\n    \r\n                        event = self.event_stream.Get(timeout=timeout)\r\n                        if event is None or self.event_stream.event_stream_stop_event.is_set():\r\n                            return None\r\n                    else: break\r\n    \r\n                return event\r\n    \r\n        def Ping(self, basestation):\r\n            basestation_id = basestation.get('deviceId')\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"subscriptions/\"+self.user_id+\"_web\",\"publishResponse\":False,\"properties\":{\"devices\":[basestation_id]}})\r\n    \r\n        def SubscribeToMotionEvents(self, basestation, callback, timeout=120):\r\n            \"\"\"\r\n            Use this method to subscribe to motion events. You must provide a callback function which will get called once per motion event.\r\n    \r\n            The callback function should have the following signature:\r\n            def callback(self, event)\r\n    \r\n            This is an example of handling a specific event, in reality, you'd probably want to write a callback for HandleEvents()\r\n            that has a big switch statement in it to handle all the various events Arlo produces.\r\n            \"\"\"\r\n            def callbackwrapper(self, event):\r\n                if event.get('properties', {}).get('motionDetected'):\r\n                    callback(self, event)\r\n    \r\n            self.HandleEvents(basestation, callbackwrapper, timeout)\r\n    \r\n        def HandleEvents(self, basestation, callback, timeout=120):\r\n            \"\"\"\r\n            Use this method to subscribe to the event stream and provide a callback that will be called for event event received.\r\n            This function will allow you to potentially write a callback that can handle all of the events received from the event stream.\r\n            \"\"\"\r\n            if not callable(callback):\r\n                raise Exception('The callback(self, event) should be a callable function.')\r\n    \r\n            basestation_id = basestation.get('deviceId')\r\n    \r\n            self.Subscribe(basestation)\r\n            if self.event_stream and self.event_stream.connected and self.event_stream.registered:\r\n                while self.event_stream.connected:\r\n                    event = self.event_stream.Get(timeout=timeout)\r\n                    if event is None or self.event_stream.event_stream_stop_event.is_set():\r\n                        return None\r\n    \r\n                    # If this event has is of resource type \"subscriptions\", then it's a ping reply event.\r\n                    # For now, these types of events will be requeued, since they are generated in response to and expected as a reply by the Ping() method.\r\n                    # HACK: Take a quick nap here to give the Ping() method's thread a chance to get the queued event.\r\n                    if event.get('resource', '').startswith('subscriptions'):\r\n                        self.event_stream.queue.put(event)\r\n                        time.sleep(0.05)\r\n                    else:\r\n                        response = callback(self, event)\r\n                        # NOTE: Not ideal, but this allows you to look for a specific event and break if you want to return it.\r\n                        if response is not None:\r\n                            return response\r\n    \r\n        def TriggerAndHandleEvent(self, basestation, trigger, callback, timeout=120):\r\n            \"\"\"\r\n            Use this method to subscribe to the event stream and provide a callback that will be called for event event received.\r\n            This function will allow you to potentially write a callback that can handle all of the events received from the event stream.\r\n            NOTE: Use this function if you need to run some code after subscribing to the eventstream, but before your callback to handle the events runs.\r\n            \"\"\"\r\n            if not callable(trigger):\r\n                raise Exception('The trigger(self, camera) should be a callable function.')\r\n            if not callable(callback):\r\n                raise Exception('The callback(self, event) should be a callable function.')\r\n    \r\n            self.Subscribe(basestation)\r\n            trigger(self)\r\n    \r\n            # NOTE: Calling HandleEvents() calls Subscribe() again, which basically turns into a no-op. Hackie I know, but it cleans up the code a bit.\r\n            return self.HandleEvents(basestation, callback, timeout)\r\n    \r\n        def GetBaseStationState(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"basestation\",\"publishResponse\":False})\r\n    \r\n        def GetCameraState(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"cameras\",\"publishResponse\":False})\r\n    \r\n        def GetRules(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"rules\",\"publishResponse\":False})\r\n    \r\n        def GetSmartFeatures(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/subscription/smart/features')\r\n    \r\n        def GetSmartAlerts(self, camera):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/devices/'+camera.get('uniqueId')+'/smartalerts')\r\n    \r\n        def GetAutomationActivityZones(self, camera):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/devices/'+camera.get('uniqueId')+'/activityzones')\r\n    \r\n        def RestartBasestation(self, basestation):\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/restart', {\"deviceId\":basestation.get('deviceId')})\r\n    \r\n        def SetAutomationActivityZones(self, camera, zone, coords, color):\r\n            \"\"\"\r\n            An activity zone is the area you draw in your video in the UI to tell Arlo what part of the scene to \"watch\".\r\n            This method takes 4 arguments.\r\n            camera: the camera you want to set an activity zone for.\r\n            name: \"Zone 1\" - the name of your activity zone.\r\n            coords: [{\"x\":0.37946943483275664,\"y\":0.3790983606557377},{\"x\":0.8685121107266436,\"y\":0.3790983606557377},{\"x\":0.8685121107266436,\"y\":1},{\"x\":0.37946943483275664,\"y\":1}] - these coordinates are the bonding box for the activity zone.\r\n            color: 45136 - the color for your bounding box.\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/'+camera.get('uniqueId')+'/activityzones', {\"name\": zone,\"coords\": coords, \"color\": color})\r\n    \r\n        def GetAutomationDefinitions(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/automation/definitions', {'uniqueIds':'all'})\r\n    \r\n        def GetCalendar(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"schedule\",\"publishResponse\":False})\r\n    \r\n        def DeleteMode(self, device, mode):\r\n            \"\"\" device can be any object that has parentId == deviceId. i.e., not a camera \"\"\"\r\n            parentId = device.get('parentId', None)\r\n            if device['deviceType'] == 'arlobridge':\r\n                return self.request.delete(f'https://{self.BASE_URL}/hmsweb/users/locations/'+device.get('uniqueId')+'/modes/'+mode)\r\n            elif not parentId or device.get('deviceId') == parentId:\r\n                return self.NotifyAndGetResponse(device, {\"action\":\"delete\",\"resource\":\"modes/\"+mode,\"publishResponse\":True})\r\n            else:\r\n                raise Exception('Only parent device modes and schedules can be deleted.');\r\n    \r\n        def GetModes(self, basestation):\r\n            \"\"\" DEPRECATED: This is the older API for getting the \"mode\". It still works, but GetModesV2 is the way the Arlo software does it these days. \"\"\"\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"modes\",\"publishResponse\":False})\r\n    \r\n        def GetModesV2(self):\r\n            \"\"\"\r\n            This is the newer API for getting the \"mode\". This method also returns the schedules.\r\n            Set a non-schedule mode to be active: {\"activeAutomations\":[{\"deviceId\":\"XXXXXXXXXXXXX\",\"timestamp\":1532015622105,\"activeModes\":[\"mode1\"],\"activeSchedules\":[]}]}\r\n            Set a schedule to be active: {\"activeAutomations\":[{\"deviceId\":\"XXXXXXXXXXXXX\",\"timestamp\":1532015790139,\"activeModes\":[],\"activeSchedules\":[\"schedule.1\"]}]}\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/devices/automation/active')\r\n    \r\n        def CustomMode(self, device, mode, schedules=[]):\r\n            \"\"\" device can be any object that has parentId == deviceId. i.e., not a camera \"\"\"\r\n            if(device[\"deviceType\"].startswith(\"arloq\")):\r\n                return self.NotifyAndGetResponse(device, {\"from\":self.user_id+\"_web\", \"to\": device.get(\"parentId\"), \"action\":\"set\",\"resource\":\"modes\", \"transId\": self.genTransId(),\"publishResponse\":True,\"properties\":{\"active\":mode}})\r\n            else:\r\n                return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/automation/active', {'activeAutomations':[{'deviceId':device.get('deviceId'),'timestamp':self.to_timestamp(datetime.now()),'activeModes':[mode],'activeSchedules':schedules}]})\r\n    \r\n        def Arm(self, device):\r\n            return self.CustomMode(device, \"mode1\")\r\n    \r\n        def Disarm(self, device):\r\n            return self.CustomMode(device, \"mode0\")\r\n    \r\n        def Calendar(self, basestation, active=True):\r\n            \"\"\"\r\n            DEPRECATED: This API appears to still do stuff, but I don't see it called in the web UI anymore when switching the mode to a schedule.\r\n    \r\n            NOTE: The Arlo API seems to disable calendar mode when switching to other modes, if it's enabled.\r\n            You should probably do the same, although, the UI reflects the switch from calendar mode to say armed mode without explicitly setting calendar mode to inactive.\r\n            \"\"\"\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"schedule\",\"publishResponse\":True,\"properties\":{\"active\":active}})\r\n    \r\n        def SetSchedule(self, basestation, schedule):\r\n            \"\"\"\r\n            The following json is what was sent to the API when I edited my schedule. It contains all of the data necessary to configure a whole week. It's a little convoluted, but you can just play around with the scheduler in Chrome and watch the schema that gets sent.\r\n    \r\n            {\r\n              \"schedule\": [\r\n                {\r\n                  \"duration\": 600,\r\n                  \"startActions\": {\r\n                    \"disableModes\": [\r\n                      \"mode0\"\r\n                    ],\r\n                    \"enableModes\": [\r\n                      \"mode1\"\r\n                    ]\r\n                  },\r\n                  \"days\": [\r\n                    \"Mo\",\r\n                    \"Tu\",\r\n                    \"We\",\r\n                    \"Th\",\r\n                    \"Fr\",\r\n                    \"Sa\",\r\n                    \"Su\"\r\n                  ],\r\n                  \"startTime\": 0,\r\n                  \"type\": \"weeklyAction\",\r\n                  \"endActions\": {\r\n                    \"disableModes\": [\r\n                      \"mode1\"\r\n                    ],\r\n                    \"enableModes\": [\r\n                      \"mode0\"\r\n                    ]\r\n                  }\r\n                },\r\n                {\r\n                  \"duration\": 360,\r\n                  \"startActions\": {\r\n                    \"disableModes\": [\r\n                      \"mode0\"\r\n                    ],\r\n                    \"enableModes\": [\r\n                      \"mode2\"\r\n                    ]\r\n                  },\r\n                  \"days\": [\r\n                    \"Mo\",\r\n                    \"Tu\",\r\n                    \"We\",\r\n                    \"Th\",\r\n                    \"Fr\",\r\n                    \"Sa\",\r\n                    \"Su\"\r\n                  ],\r\n                  \"startTime\": 1080,\r\n                  \"type\": \"weeklyAction\",\r\n                  \"endActions\": {\r\n                    \"disableModes\": [\r\n                      \"mode2\"\r\n                    ],\r\n                    \"enableModes\": [\r\n                      \"mode0\"\r\n                    ]\r\n                  }\r\n                },\r\n                {\r\n                  \"duration\": 480,\r\n                  \"startActions\": {\r\n                    \"disableModes\": [\r\n                      \"mode0\"\r\n                    ],\r\n                    \"enableModes\": [\r\n                      \"mode3\"\r\n                    ]\r\n                  },\r\n                  \"days\": [\r\n                    \"Tu\"\r\n                  ],\r\n                  \"startTime\": 600,\r\n                  \"type\": \"weeklyAction\",\r\n                  \"endActions\": {\r\n                    \"disableModes\": [\r\n                      \"mode3\"\r\n                    ],\r\n                    \"enableModes\": [\r\n                      \"mode0\"\r\n                    ]\r\n                  }\r\n                }\r\n              ],\r\n              \"name\": \"\",\r\n              \"id\": \"schedule.1\",\r\n              \"enabled\": true\r\n            }\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/locations/'+basestation.get('uniqueId')+'/schedules', )\r\n    \r\n        def AdjustBrightness(self, basestation, camera, brightness=0):\r\n            \"\"\"\r\n            NOTE: Brightness is between -2 and 2 in increments of 1 (-2, -1, 0, 1, 2).\r\n            Setting it to an invalid value has no effect.\r\n    \r\n            Returns:\r\n            {\r\n              \"action\": \"is\",\r\n              \"from\": \"XXXXXXXXXXXXX\",\r\n              \"properties\": {\r\n                  \"brightness\": -2\r\n              },\r\n              \"resource\": \"cameras/XXXXXXXXXXXXX\",\r\n              \"to\": \"336-XXXXXXX_web\",\r\n              \"transId\": \"web!XXXXXXXX.389518!1514956240683\"\r\n            }\r\n            \"\"\"\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+camera.get('deviceId'),\"publishResponse\":True,\"properties\":{\"brightness\":brightness}})\r\n    \r\n        def ToggleCamera(self, basestation, camera, active=True):\r\n            \"\"\"\r\n            active: True - Camera is off.\r\n            active: False - Camera is on.\r\n            \"\"\"\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+camera.get('deviceId'),\"publishResponse\":True,\"properties\":{\"privacyActive\":active}})\r\n    \r\n        def PushToTalk(self, camera):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/devices/'+camera.get('uniqueId')+'/pushtotalk')\r\n    \r\n        \"\"\" General alert toggles \"\"\"\r\n        def SetMotionAlertsOn(self, basestation, sensitivity=5):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"motionDetection\":{\"armed\":True,\"sensitivity\":sensitivity,\"zones\":[]}}})\r\n    \r\n        def SetMotionAlertsOff(self, basestation, sensitivity=5):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"motionDetection\":{\"armed\":False,\"sensitivity\":sensitivity,\"zones\":[]}}})\r\n    \r\n        def SetAudioAlertsOn(self, basestation, sensitivity=3):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"audioDetection\":{\"armed\":True,\"sensitivity\":sensitivity}}})\r\n    \r\n        def SetAudioAlertsOff(self, basestation, sensitivity=3):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"audioDetection\":{\"armed\":False,\"sensitivity\":sensitivity}}})\r\n    \r\n        def AlertNotificationMethods(self, basestation, action=\"disabled\", email=False, push=False):\r\n            \"\"\" action : disabled OR recordSnapshot OR recordVideo \"\"\"\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"eventAction\":{\"actionType\":action,\"stopType\":\"timeout\",\"timeout\":15,\"emailNotification\":{\"enabled\":email,\"emailList\":[\"__OWNER_EMAIL__\"]},\"pushNotification\":push}}})\r\n    \r\n        \"\"\" Arlo Baby Audio Control \"\"\"\r\n        def GetAudioPlayback(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"audioPlayback\",\"publishResponse\":False})\r\n    \r\n        def PlayTrack(self, basestation, track_id=\"2391d620-e491-4412-99f6-e9a40d6046ed\", position=0):\r\n            \"\"\"\r\n            Defaulting to 'hugh little baby', which is a supplied track. I hope the ID is the same for all\r\n            \"\"\"\r\n            return self.Notify(basestation, {\"action\":\"playTrack\",\"resource\":\"audioPlayback/player\",\"properties\":{\"trackId\":track_id,\"position\":position}})\r\n    \r\n        def PauseTrack(self, basestation):\r\n            return self.Notify(basestation, {\"action\":\"pause\",\"resource\":\"audioPlayback/player\"})\r\n    \r\n        def UnPauseTrack(self, basestation):\r\n            return self.Notify(basestation, {\"action\":\"play\",\"resource\":\"audioPlayback/player\"})\r\n    \r\n        def SkipTrack(self, basestation):\r\n            return self.Notify(basestation, {\"action\":\"nextTrack\",\"resource\":\"audioPlayback/player\"})\r\n    \r\n        def SetSleepTimerOn(self, basestation, time=calendar.timegm(time.gmtime()) + 300, timediff=0):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"audioPlayback/config\",\"publishResponse\":True,\"properties\":{\"config\":{\"sleepTime\":time,\"sleepTimeRel\":timediff}}})\r\n    \r\n        def SetSleepTimerOff(self, basestation, time=0, timediff=300):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"audioPlayback/config\",\"publishResponse\":True,\"properties\":{\"config\":{\"sleepTime\": time,\"sleepTimeRel\":timediff}}})\r\n    \r\n        def SetLoopBackModeContinuous(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"audioPlayback/config\",\"publishResponse\":True,\"properties\":{\"config\":{\"loopbackMode\":\"continuous\"}}})\r\n    \r\n        def SetLoopBackModeSingleTrack(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"audioPlayback/config\",\"publishResponse\":True,\"properties\":{\"config\":{\"loopbackMode\":\"singleTrack\"}}})\r\n    \r\n        def SetShuffleOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"audioPlayback/config\",\"publishResponse\":True,\"properties\":{\"config\":{\"shuffleActive\":True}}})\r\n    \r\n        def SetShuffleOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"audioPlayback/config\",\"publishResponse\":True,\"properties\":{\"config\":{\"shuffleActive\":False}}})\r\n    \r\n        def SetVolume(self, basestation, mute=False, volume=50):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"speaker\":{\"mute\":mute,\"volume\":volume}}})\r\n    \r\n        \"\"\"  Baby Arlo Nightlight, (current state is in the arlo.GetCameraState(cameras[0][\"properties\"][0][\"nightLight\"]) \"\"\"\r\n        def SetNightLightOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"nightLight\":{\"enabled\":True}}})\r\n    \r\n        def SetNightLightOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"nightLight\":{\"enabled\":False}}})\r\n    \r\n        def SetNightLightBrightness(self, basestation, level=200):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"nightLight\":{\"brightness\":level}}})\r\n    \r\n        def SetNightLightMode(self, basestation, mode=\"rainbow\"):\r\n            \"\"\" mode: rainbow or rgb. \"\"\"\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"nightLight\":{\"mode\":mode}}})\r\n    \r\n        def SetNightLightColor(self, basestation, red=255, green=255, blue=255):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"nightLight\":{\"rgb\":{\"blue\":blue,\"green\":green,\"red\":red}}}})\r\n    \r\n        def SetNightLightTimerOn(self, basestation, time=calendar.timegm(time.gmtime()) + 300, timediff=0):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"nightLight\":{\"sleepTime\":time,\"sleepTimeRel\":timediff}}})\r\n    \r\n        def SetNightLightTimerOff(self, basestation, time=0, timediff=300):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId'),\"publishResponse\":True,\"properties\":{\"nightLight\":{\"sleepTime\":time,\"sleepTimeRel\":timediff}}})\r\n    \r\n        \"\"\" Baby Arlo Sensors \"\"\"\r\n        def GetCameraTempReading(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/history\",\"publishResponse\":False})\r\n    \r\n        def GetSensorConfig(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"get\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":False})\r\n    \r\n        def SetAirQualityAlertOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"airQuality\":{\"alertsEnabled\":True}}})\r\n    \r\n        def SetAirQualityAlertOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"airQuality\":{\"alertsEnabled\":False}}})\r\n    \r\n        def SetAirQualityAlertThresholdMin(self, basestation, number=400):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"airQuality\":{\"minThreshold\":number}}})\r\n    \r\n        def SetAirQualityAlertThresholdMax(self, basestation, number=700):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"airQuality\":{\"maxThreshold\":number}}})\r\n    \r\n        def SetAirQualityRecordingOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"airQuality\":{\"recordingEnabled\":True}}})\r\n    \r\n        def SetAirQualityRecordingOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"airQuality\":{\"recordingEnabled\":False}}})\r\n    \r\n        def SetHumidityAlertOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"humidity\":{\"alertsEnabled\":True}}})\r\n    \r\n        def SetHumidityAlertOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"humidity\":{\"alertsEnabled\":False}}})\r\n    \r\n        def SetHumidityAlertThresholdMin(self, basestation, number=400):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"humidity\":{\"minThreshold\":number}}})\r\n    \r\n        def SetHumidityAlertThresholdMax(self, basestation, number=800):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"humidity\":{\"maxThreshold\":number}}})\r\n    \r\n        def SetHumidityRecordingOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"humidity\":{\"recordingEnabled\":True}}})\r\n    \r\n        def SetHumidityRecordingOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"humidity\":{\"recordingEnabled\":False}}})\r\n    \r\n        def SetTempAlertOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"temperature\":{\"alertsEnabled\":True}}})\r\n    \r\n        def SetTempAlertOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"temperature\":{\"alertsEnabled\":False}}})\r\n    \r\n        def SetTempAlertThresholdMin(self, basestation, number=200):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"temperature\":{\"minThreshold\":number}}})\r\n    \r\n        def SetTempAlertThresholdMax(self, basestation, number=240):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"temperature\":{\"maxThreshold\":number}}})\r\n    \r\n        def SetTempRecordingOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"temperature\":{\"recordingEnabled\":True}}})\r\n    \r\n        def SetTempRecordingOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"cameras/\"+basestation.get('deviceId')+\"/ambientSensors/config\",\"publishResponse\":True,\"properties\":{\"temperature\":{\"recordingEnabled\":False}}})\r\n    \r\n        def SetTempUnit(self, uniqueId, unit=\"C\"):\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/'+uniqueId+'/tempUnit', {\"tempUnit\":unit})\r\n    \r\n        def SirenOn(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"siren\",\"publishResponse\":True,\"properties\":{\"sirenState\":\"on\",\"duration\":300,\"volume\":8,\"pattern\":\"alarm\"}})\r\n    \r\n        def SirenOff(self, basestation):\r\n            return self.NotifyAndGetResponse(basestation, {\"action\":\"set\",\"resource\":\"siren\",\"publishResponse\":True,\"properties\":{\"sirenState\":\"off\",\"duration\":300,\"volume\":8,\"pattern\":\"alarm\"}})\r\n    \r\n        def Reset(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/library/reset')\r\n    \r\n        def GetServiceLevelSettings(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/serviceLevel/settings')\r\n    \r\n        def GetServiceLevel(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/serviceLevel')\r\n    \r\n        def GetServiceLevelV2(self):\r\n            \"\"\" DEPRECATED: This API still works, but I don't see it being called in the web UI anymore. \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/serviceLevel/v2')\r\n    \r\n        def GetServiceLevelV3(self):\r\n            \"\"\" DEPRECATED: This API still works, but I don't see it being called in the web UI anymore. \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/serviceLevel/v3')\r\n    \r\n        def GetServiceLevelV4(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/serviceLevel/v4')\r\n    \r\n        def GetUpdateFeatures(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/devices/updateFeatures/feature')\r\n    \r\n        def GetPaymentBilling(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/payment/billing/'+self.user_id)\r\n    \r\n        def GetPaymentOffers(self):\r\n            \"\"\" DEPRECATED: This API still works, but I don't see it being called in the web UI anymore. \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/payment/offers')\r\n    \r\n        def GetPaymentOffersV2(self):\r\n            \"\"\" DEPRECATED: This API still works, but I don't see it being called in the web UI anymore. \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/payment/offers/v2')\r\n    \r\n        def GetPaymentOffersV3(self):\r\n            \"\"\" DEPRECATED: This API still works, but I don't see it being called in the web UI anymore. \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/payment/offers/v3')\r\n    \r\n        def GetPaymentOffersV4(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/payment/offers/v4')\r\n    \r\n        def SetOCProfile(self, firstName, lastName, country='United States', language='en', spam_me=0):\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/ocprofile', {\"firstName\":\"Jeffrey\",\"lastName\":\"Walter\",\"country\":country,\"language\":language,\"mailProgram\":spam_me})\r\n    \r\n        def GetOCProfile(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/ocprofile')\r\n    \r\n        def GetProfile(self):\r\n            \"\"\"\r\n            This call returns the following:\r\n            {\r\n              \"data\": {\r\n                  \"_type\": \"User\",\r\n                  \"firstName\": \"Joe\",\r\n                  \"lastName\": \"Bloggs\",\r\n                  \"language\": \"en\",\r\n                  \"country\": \"GB\",\r\n                  \"acceptedPolicy\": 1,\r\n                  \"currentPolicy\": 1,\r\n                  \"validEmail\": true\r\n              },\r\n              \"success\": true\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/profile')\r\n    \r\n        def GetAccount(self):\r\n            \"\"\"\r\n            This call returns the following:\r\n            {\r\n              \"data\": {\r\n                \"userId\": \"XXX-XXXXXXX\",\r\n                \"email\": \"joe.bloggs@gmail.com\",\r\n                \"dateCreated\": 1585157000819,\r\n                \"dateDeviceRegistered\": 1585161139527,\r\n                \"countryCode\": \"GB\",\r\n                \"language\": \"en-gb\",\r\n                \"firstName\": \"Joe\",\r\n                \"lastName\": \"Bloggs\",\r\n                \"s3StorageId\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\r\n                \"tosVersion\": \"5\",\r\n                \"tosAgreeDate\": 1593126066795,\r\n                \"tosShownVersion\": \"5\",\r\n                \"lastModified\": 1585161137898,\r\n                \"accountStatus\": \"registered\",\r\n                \"paymentId\": \"xxxxxxxx\",\r\n                \"serialNumber\": \"xxxxxxxxxxxxx\",\r\n                \"mobilePushData\": {\r\n                    \"mobilePushOsMap\": {\r\n                        \"android\": [\r\n                            {\r\n                                \"token\": \"xxxxxxxxxxxxxxxxxxx\",\r\n                                \"endpoint\": \"arn:aws:sns:eu-west-1:xxxxxxxxxxxx:endpoint/GCM/Arlo_Android_Prod/xxxxxxxxxxxxxxxxxxxxxx\",\r\n                                \"createdDate\": \"20201310_0622\",\r\n                                \"iosDebugModeFlag\": false\r\n                            },\r\n                            {\r\n                                \"token\": \"xxxxxxxxxxxxxxxxxxxx\",\r\n                                \"endpoint\": \"arn:aws:sns:eu-west-1:xxxxxxxxxxxx:endpoint/GCM/Arlo_Android_Prod/xxxxxxxxxxxxxxxxxxxxxxx\",\r\n                                \"createdDate\": \"20210801_0335\",\r\n                                \"iosDebugModeFlag\": false\r\n                            }\r\n                        ]\r\n                    }\r\n                },\r\n                \"recycleBinQuota\": 0,\r\n                \"favoriteQuota\": 0,\r\n                \"validEmail\": true,\r\n                \"locationCreated\": false,\r\n                \"readyToClose\": false,\r\n                \"lastMessageTimeToBS\": 1608375685602\r\n              },\r\n              \"success\": true\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/account')\r\n    \r\n        def GetSession(self):\r\n            \"\"\"\r\n            Returns something like the following:\r\n            {\r\n              \"userId\": \"XXX-XXXXXXX\",\r\n              \"email\": \"jeffreydwalter@gmail.com\",\r\n              \"token\": \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\r\n              \"paymentId\": \"XXXXXXXX\",\r\n              \"accountStatus\": \"registered\",\r\n              \"serialNumber\": \"XXXXXXXXXXXXXX\",\r\n              \"countryCode\": \"US\",\r\n              \"tocUpdate\": false,\r\n              \"policyUpdate\": false,\r\n              \"validEmail\": true,\r\n              \"arlo\": true,\r\n              \"dateCreated\": 1463975008658\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/session')\r\n    \r\n        def GetSessionV2(self):\r\n            \"\"\"\r\n            Returns something like the following:\r\n            {\r\n              \"userId\": \"XXX-XXXXXXX\",\r\n              \"email\": \"jeffreydwalter@gmail.com\",\r\n              \"token\": \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\r\n              \"paymentId\": \"XXXXXXXX\",\r\n              \"accountStatus\": \"registered\",\r\n              \"serialNumber\": \"XXXXXXXXXXXXXX\",\r\n              \"countryCode\": \"US\",\r\n              \"tocUpdate\": false,\r\n              \"policyUpdate\": false,\r\n              \"validEmail\": true,\r\n              \"arlo\": true,\r\n              \"dateCreated\": 1463975008658\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/session/v2')\r\n    \r\n        def GetFriends(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/friends')\r\n    \r\n        def GetLocations(self):\r\n            \"\"\"\r\n            This call returns the following:\r\n            {\r\n              \"id\":\"XXX-XXXXXXX_20160823042047\",\r\n              \"name\":\"Home\",\r\n              \"ownerId\":\"XXX-XXXXXXX\",\r\n              \"longitude\":X.XXXXXXXXXXXXXXXX,\r\n              \"latitude\":X.XXXXXXXXXXXXXXXX,\r\n              \"address\":\"123 Middle Of Nowhere Bumbfuck, EG, 12345\",\r\n              \"homeMode\":\"schedule\",\r\n              \"awayMode\":\"mode1\",\r\n              \"geoEnabled\":false,\r\n              \"geoRadius\":150.0,\r\n              \"uniqueIds\":[\r\n                 \"XXX-XXXXXXX_XXXXXXXXXXXXX\"\r\n              ],\r\n              \"smartDevices\":[\r\n                 \"XXXXXXXXXX\",\r\n                 \"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\r\n              ],\r\n              \"pushNotifyDevices\":[\r\n                 \"XXXXXXXXXX\"\r\n              ]\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/locations')\r\n    \r\n        def GetEmergencyLocations(self):\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/emergency/locations')\r\n    \r\n        def Geofencing(self, location_id, active=True):\r\n            \"\"\"\r\n            Get location_id is the id field from the return of GetLocations()\r\n            NOTE: The Arlo API seems to disable geofencing mode when switching to other modes, if it's enabled.\r\n            You should probably do the same, although, the UI reflects the switch from calendar mode to say armed mode without explicitly setting calendar mode to inactive.\r\n            \"\"\"\r\n            return self.request.put(f'https://{self.BASE_URL}/hmsweb/users/locations/'+location_id, {'geoEnabled':active})\r\n    \r\n        def GetDevice(self, device_name):\r\n            def is_device(device):\r\n                return device['deviceName'] == device_name\r\n            return list(filter(is_device, self.GetDevices()))[0]\r\n    \r\n        def GetDevices(self, device_type=None, filter_provisioned=None):\r\n            \"\"\"\r\n            This method returns an array that contains the basestation, cameras, etc. and their metadata.\r\n            If you pass in a valid device type, as a string or a list, this method will return an array of just those devices that match that type. An example would be ['basestation', 'camera']\r\n            To filter provisioned or unprovisioned devices pass in a True/False value for filter_provisioned. By default both types are returned.\r\n            \"\"\"\r\n            devices = self.request.get(f'https://{self.BASE_URL}/hmsweb/users/devices')\r\n            if device_type:\r\n                devices = [ device for device in devices if device['deviceType'] in device_type]\r\n    \r\n            if filter_provisioned is not None:\r\n                if filter_provisioned:\r\n                    devices = [ device for device in devices if device.get(\"state\") == 'provisioned']\r\n                else:\r\n                    devices = [ device for device in devices if device.get(\"state\") != 'provisioned']\r\n    \r\n            return devices\r\n    \r\n        def GetDeviceSupport(self):\r\n            \"\"\"\r\n            DEPRECATED: This API still works, but I don't see it being called in the web UI anymore.\r\n    \r\n            This API looks like it's mainly used by the website, but I'm including it for completeness sake.\r\n            It returns something like the following:\r\n            {\r\n              \"devices\": [\r\n                {\r\n                  \"deviceType\": \"arloq\",\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/pc_troubleshoot.html\",\r\n                    \"plugin\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/pc_plugin.html\",\r\n                    \"connection\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/pc_connection.html\",\r\n                    \"connectionFailed\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/pc_connection_fail.html\",\r\n                    \"press_sync\": \"https://vzs3-prod-common.s3. amazonaws.com/static/html/en/pc_press_sync.html\",\r\n                    \"resetDevice\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/reset_arloq.html\",\r\n                    \"qr_how_to\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/pc_qr_how_to.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"basestation\",\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/bs_troubleshoot.html\",\r\n                    \"connection\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/bs_connection.html\",\r\n                    \"sync\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/bs_sync_camera.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"arloqs\",\r\n                  \"urls\": {\r\n                    \"ethernetSetup\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/ethernet_setup.html\",\r\n                    \"plugin\": \"https://    vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/aqp_plugin.html\",\r\n                    \"connectionWiFi\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/connection_in_progress_wifi.html\",\r\n                    \"poeSetup\": \"https://vzs3-prod-common.s3.       amazonaws.com/static/html/en/arloqs/poe_setup.html\",\r\n                    \"connection\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/connection_in_progress.html\",\r\n                    \"connectionFailed\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/connection_fail.html\",\r\n                    \"press_sync\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/press_sync.html\",\r\n                    \"connectionType\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/connection_type.html\",\r\n                    \"resetDevice\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/reset_device.html\",\r\n                    \"qr_how_to\": \"https://vzs3-prod-common.s3.amazonaws.com/static/html/en/arloqs/qr_how_to.html\"\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/devicesupport')\r\n    \r\n        def GetDeviceSupportv2(self):\r\n            \"\"\"\r\n            DEPRECATED: This API still works, but I don't see it being called in the web UI anymore.\r\n    \r\n            It returns something like the following:\r\n            {\r\n              \"devices\": [\r\n                {\r\n                  \"deviceType\": \"arloq\",\r\n                  \"modelId\": [\r\n                    \"VMC3040\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"arloq/troubleshoot.html\",\r\n                    \"plugin\": \"arloq/plugin.html\",\r\n                    \"qrHowTo\": \"arloq/qrHowTo.html\",\r\n                    \"connection\": \"arloq/connection.html\",\r\n                    \"connectionInProgress\": \"arloq/connectionInProgress.html\",\r\n                    \"connectionFailed\": \"arloq/connectionFailed.html\",\r\n                    \"pressSync\": \"arloq/pressSync.html\",\r\n                    \"resetDevice\": \"arloq/resetDevice.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"basestation\",\r\n                  \"modelId\": [\r\n                    \"VMB3010\",\r\n                    \"VMB3010r2\",\r\n                    \"VMB3500\",\r\n                    \"VMB4000\",\r\n                    \"VMB4500\",\r\n                    \"VZB3010\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"basestation/troubleshoot.html\",\r\n                    \"plugin\": \"basestation/plugin.html\",\r\n                    \"sync3\": \"basestation/sync3.html\",\r\n                    \"troubleshootBS\": \"basestation/troubleshootBS.html\",\r\n                    \"connection\": \"basestation/connection.html\",\r\n                    \"connectionInProgress\": \"basestation/connectionInProgress.html\",\r\n                    \"sync2\": \"basestation/sync2.html\",\r\n                    \"connectionFailed\": \"basestation/connectionFailed.html\",\r\n                    \"sync1\": \"basestation/sync1.html\",\r\n                    \"resetDevice\": \"basestation/resetDevice.html\",\r\n                    \"syncComplete\": \"basestation/syncComplete.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"arlobaby\",\r\n                  \"modelId\": [\r\n                    \"ABC1000\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"bleSetupError\": \"arlobaby/bleSetupError.html\",\r\n                    \"troubleshoot\": \"arlobaby/troubleshoot.html\",\r\n                    \"homekitCodeInstruction\": \"arlobaby/homekitCodeInstruction.html\",\r\n                    \"connectionInProgress\": \"arlobaby/connectionInProgress.html\",\r\n                    \"connectionFailed\": \"arlobaby/connectionFailed.html\",\r\n                    \"resetDevice\": \"arlobaby/resetDevice.html\",\r\n                    \"plugin\": \"arlobaby/plugin.html\",\r\n                    \"qrHowTo\": \"arlobaby/qrHowTo.html\",\r\n                    \"warning\": \"arlobaby/warning.html\",\r\n                    \"connection\": \"arlobaby/connection.html\",\r\n                    \"pressSync\": \"arlobaby/pressSync.html\",\r\n                    \"bleInactive\": \"arlobaby/bleInactive.html\",\r\n                    \"pluginIOS\": \"arlobaby/pluginIOS.html\",\r\n                    \"homekitSetup\": \"arlobaby/homekitSetup.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"lteCamera\",\r\n                  \"modelId\": [\r\n                    \"VML4030\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"lteCamera/troubleshoot.html\",\r\n                    \"resetHowTo\": \"lteCamera/resetHowTo.html\",\r\n                    \"plugin\": \"lteCamera/plugin.html\",\r\n                    \"qrHowTo\": \"lteCamera/qrHowTo.html\",\r\n                    \"connectionInProgress\": \"lteCamera/connectionInProgress.html\",\r\n                    \"connectionFailed\": \"lteCamera/connectionFailed.html\",\r\n                    \"resetDevice\": \"lteCamera/resetHowTo.html\",\r\n                    \"resetComplete\": \"lteCamera/resetComplete.html\",\r\n                    \"syncComplete\": \"lteCamera/syncComplete.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"arloqs\",\r\n                  \"modelId\": [\r\n                    \"VMC3040S\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"ethernetSetup\": \"arloqs/ethernetSetup.html\",\r\n                    \"troubleshoot\": \"arloqs/troubleshoot.html\",\r\n                    \"plugin\": \"arloqs/plugin.html\",\r\n                    \"poeSetup\": \"arloqs/poeSetup.html\",\r\n                    \"connectionInProgressWiFi\": \"arloqs/connectionInProgressWifi.html\",\r\n                    \"qrHowTo\": \"arloqs/qrHowTo.html\",\r\n                    \"connectionInProgress\": \"arloqs/connectionInProgress.html\",\r\n                    \"connectionFailed\": \"arloqs/connectionFailed.html\",\r\n                    \"pressSync\": \"arloqs/pressSync.html\",\r\n                    \"connectionType\": \"arloqs/connectionType.html\",\r\n                    \"resetDevice\": \"arloqs/resetDevice.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"bridge\",\r\n                  \"modelId\": [\r\n                    \"ABB1000\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"bridge/troubleshoot.html\",\r\n                    \"fwUpdateInProgress\": \"bridge/fwUpdateInProgress.html\",\r\n                    \"qrHowToUnplug\": \"bridge/qrHowToUnplug.html\",\r\n                    \"fwUpdateDone\": \"bridge/fwUpdateDone.html\",\r\n                    \"fwUpdateAvailable\": \"bridge/fwUpdateAvailable.html\",\r\n                    \"needHelp\": \"https://www.arlo.com/en-us/support/#support_arlo_light\",\r\n                    \"wifiError\": \"bridge/wifiError.html\",\r\n                    \"bleAndroid\": \"bridge/bleInactiveAND.html\",\r\n                    \"bleIOS\": \"bridge/bleInactiveIOS.html\",\r\n                    \"connectionInProgress\": \"bridge/connectionInProgress.html\",\r\n                    \"connectionFailed\": \"bridge/connectionFailed.html\",\r\n                    \"manualPair\": \"bridge/manualPairing.html\",\r\n                    \"resetDevice\": \"bridge/resetDevice.html\",\r\n                    \"lowPower\": \"bridge/lowPowerZoneSetup.html\",\r\n                    \"fwUpdateFailed\": \"bridge/fwUpdateFailed.html\",\r\n                    \"fwUpdateCheckFailed\": \"bridge/fwUpdateCheckFailed.html\",\r\n                    \"plugin\": \"bridge/plugin.html\",\r\n                    \"qrHowTo\": \"bridge/qrHowTo.html\",\r\n                    \"pressSync\": \"bridge/pressSync.html\",\r\n                    \"pluginNoLED\": \"bridge/pluginNoLED.html\",\r\n                    \"fwUpdateCheck\": \"bridge/fwUpdateCheck.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"lights\",\r\n                  \"modelId\": [\r\n                    \"AL1101\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"lights/troubleshoot.html\",\r\n                    \"needHelp\": \"https://kb.netgear.com/000053159/Light-discovery-failed.html\",\r\n                    \"bleInactiveAND\": \"lights/bleInactiveAND.html\",\r\n                    \"connectionInProgress\": \"lights/connectionInProgress.html\",\r\n                    \"connectionFailed\": \"lights/connectionFailed.html\",\r\n                    \"addBattery\": \"lights/addBattery.html\",\r\n                    \"tutorial1\": \"lights/tutorial1.html\",\r\n                    \"plugin\": \"lights/plugin.html\",\r\n                    \"tutorial2\": \"lights/tutorial2.html\",\r\n                    \"tutorial3\": \"lights/tutorial3.html\",\r\n                    \"configurationInProgress\": \"lights/configurationInProgress.html\",\r\n                    \"qrHowTo\": \"lights/qrHowTo.html\",\r\n                    \"pressSync\": \"lights/pressSync.html\",\r\n                    \"bleInactiveIOS\": \"lights/bleInactiveIOS.html\",\r\n                    \"syncComplete\": \"lights/syncComplete.html\"\r\n                  }\r\n                },\r\n                {\r\n                  \"deviceType\": \"routerM1\",\r\n                  \"modelId\": [\r\n                    \"MR1100\"\r\n                  ],\r\n                  \"urls\": {\r\n                    \"troubleshoot\": \"routerM1/troubleshoot.html\",\r\n                    \"help\": \"routerM1/help.html\",\r\n                    \"pairingFailed\": \"routerM1/pairingFailed.html\",\r\n                    \"needHelp\": \"https://acupdates.netgear.com/help/redirect.aspx?url=m1arlo-kbb\",\r\n                    \"plugin\": \"routerM1/plugin.html\",\r\n                    \"pairing\": \"routerM1/pairing.html\",\r\n                    \"connectionInProgress\": \"routerM1/connectionInProgress.html\",\r\n                    \"sync2\": \"routerM1/sync2.html\",\r\n                    \"connectionFailed\": \"routerM1/connectionFailed.html\",\r\n                    \"sync1\": \"routerM1/sync1.html\",\r\n                    \"sync\": \"routerM1/sync.html\",\r\n                    \"syncComplete\": \"routerM1/syncComplete.html\"\r\n                  }\r\n                }\r\n              ],\r\n              \"selectionUrls\": {\r\n                \"addDevice\": \"addDeviceBsRuAqAqpLteAbcMrBgLt.html\",\r\n                \"selectBasestation\": \"selectBsMr.html\",\r\n                \"deviceSelection\": \"deviceBsAqAqpLteAbcMrLtSelection.html\",\r\n                \"selectLights\": \"selectBgLt.html\"\r\n              },\r\n              \"baseUrl\": \"https://vzs3-prod-common.s3.amazonaws.com/static/v2/html/en/\"\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/devicesupport/v2')\r\n    \r\n        def GetDeviceSupportV3(self):\r\n            \"\"\"\r\n            This is the latest version of the device support api.\r\n            It returns something like the following:\r\n            {\r\n              \"data\": {\r\n                \"devices\": {\r\n                  \"camera\": {\r\n                    \"modelIds\": [\r\n                      \"VMC3010\",\r\n                      \"VMC3030\",\r\n                      \"VMC4030\",\r\n                      \"VMC4030P\",\r\n                      \"VMC5040\",\r\n                      \"VZC3010\",\r\n                      \"VZC3030\"\r\n                    ],\r\n                    \"connectionTypes\": {\r\n                      \"WPS\": true,\r\n                      \"BLE\": true\r\n                    },\r\n                    \"kbArticles\": {\r\n                      \"insertBatteries\": \"https://kb.arlo.com/980150/Safety-Rules-for-Arlo-Wire-Free-Camera-Batteries\",\r\n                      \"syncBasestation\": \"https://kb.arlo.com/987/How-do-I-set-up-and-sync-my-Arlo-Wire-Free-cameras\",\r\n                      \"sync\": \"https://kb.arlo.com/987/How-do-I-set-up-and-sync-my-Arlo-Wire-Free-camera\",\r\n                      \"firmwareUpdate\": \"https://kb.arlo.com/4736/How-do-I-update-my-Arlo-firmware-manually\"\r\n                    }\r\n                  },\r\n                  \"arloq\": {\r\n                    \"modelIds\": [\r\n                      \"VMC3040\",\r\n                      \"VMC3040S\"\r\n                    ],\r\n                    \"kbArticles\": {\r\n                      \"power\": \"https://kb.arlo.com/1001944/How-do-I-set-up-Arlo-Q-on-iOS\",\r\n                      \"qrCode\": \"https://kb.arlo.com/1001944/How-do-I-set-up-Arlo-Q-on-iOS\",\r\n                      \"power_android\": \"https://kb.arlo.com/1002006/How-do-I-set-up-Arlo-Q-on-Android\",\r\n                      \"qrCode_android\":  \"https://kb.arlo.com/1002006/How-do-I-set-up-Arlo-Q-on-Android\"\r\n                    }\r\n                  },\r\n                  \"basestation\": {\r\n                    \"modelIds\": [\r\n                      \"VMB3010\",\r\n                      \"VMB4000\",\r\n                      \"VMB3010r2\",\r\n                      \"VMB3500\",\r\n                      \"VZB3010\",\r\n                      \"VMB4500\",\r\n                      \"VMB5000\"\r\n                    ],\r\n                    \"smartHubs\": [\r\n                      \"VMB5000\"\r\n                    ],\r\n                    \"kbArticles\": {\r\n                      \"pluginNetworkCable\": \"https://kb.arlo.com/1179139/How-do-I-connect-my-Arlo-or-Arlo-Pro-base-station-to-the-Internet\",\r\n                      \"power\": \"https://kb.arlo.com/1179139/How-do-I-connect-my-Arlo-or-Arlo-Pro-base-station-to-the-Internet\",\r\n                      \"led\": \"https://kb.arlo.com/1179139/How-do-I-connect-my-Arlo-or-Arlo-Pro-base-station-to-the-Internet\",\r\n                      \"learnMore\": \"https://kb.arlo.com/000062124/How-do-I-record-4K-videos-to-a-microSD-card\"\r\n                    }\r\n                  },\r\n                  \"arlobaby\": {\r\n                    \"modelIds\": [\r\n                      \"ABC1000\"\r\n                    ],\r\n                    \"kbArticles\": {\r\n                      \"power\": \"https://kb.arlo.com/1282682/How-do-I-power-cycle-my-Arlo-Baby-camera\",\r\n                      \"qrCode\": \"https://kb.arlo.com/1282700/How-do-I-set-up-my-Arlo-Baby-camera\"\r\n                    }\r\n                  },\r\n                  \"lteCamera\":{\r\n                    \"modelIds\":[\r\n                      \"VML4030\"\r\n                    ],\r\n                    \"kbArticles\":{\r\n                      \"servicePlan\":\"https://kb.arlo.com/1286865/What-Arlo-Mobile-service-plans-are-available\",\r\n                      \"simActivation\":\"https://kb.arlo.com/1286865/What-Arlo-Mobile-service-plans-are-available\",\r\n                      \"qrCode\":\"https://kb.arlo.com/1201822/How-do-I-set-up-my-Arlo-Go-camera\"\r\n                    }\r\n                  },\r\n                  \"bridge\": {\r\n                    \"modelIds\": [\r\n                      \"ABB1000\"\r\n                    ],\r\n                    \"kbArticles\": {\r\n                      \"power\": \"https://kb.arlo.com/000062047\",\r\n                      \"sync\": \"https://kb.arlo.com/000062037\",\r\n                      \"qrCode\": \"https://kb.arlo.com/000061886\",\r\n                      \"factoryReset\": \"https://kb.arlo.com/000061837\"\r\n                    }\r\n                  },\r\n                  \"lights\": {\r\n                    \"modelIds\": [\r\n                      \"AL1101\"\r\n                    ],\r\n                    \"kbArticles\": {\r\n                      \"sync\": \"https://kb.arlo.com/000062005\",\r\n                      \"insertBatteries\": \"https://kb.arlo.com/000061952\",\r\n                      \"qrCode\": \"https://kb.arlo.com/000061886\"\r\n                    }\r\n                  },\r\n                  \"routerM1\":{\r\n                    \"modelIds\":[\r\n                      \"MR1100\"\r\n                    ],\r\n                    \"kbArticles\":{\r\n                      \"lookupFailed\":\"https://kb.arlo.com/1179130/Arlo-can-t-discover-my-base-station-during-installation-what-do-I-do\"\r\n                    }\r\n                  },\r\n                  \"chime\": {\r\n                    \"modelIds\": [\r\n                      \"AC1001\"\r\n                    ],\r\n                    \"kbArticles\": {\r\n                      \"ledNotBlinking\":\"https://kb.arlo.com/000061924\",\r\n                      \"led\":\"https://kb.arlo.com/000061847\",\r\n                      \"factoryReset\":\"https://kb.arlo.com/000061879\",\r\n                      \"connectionFailed\":\"https://kb.arlo.com/000061880\"\r\n                    }\r\n                  },\r\n                  \"doorbell\": {\r\n                    \"modelIds\": [\r\n                      \"AAD1001\"\r\n                    ],\r\n                    \"kbArticles\": {\r\n                      \"led\":\"https://kb.arlo.com/000061847\",\r\n                      \"factoryReset\":\"https://kb.arlo.com/000061842\",\r\n                      \"pairCamera\":\"https://kb.arlo.com/000061897\",\r\n                      \"existingChime\":\"https://kb.arlo.com/000061856\",\r\n                      \"noWiring\":\"https://kb.arlo.com/000061859\",\r\n                      \"connectionFailed\":\"https://kb.arlo.com/000061868\",\r\n                      \"pairCameraFailed\":\"https://kb.arlo.com/000061893\",\r\n                      \"testChimeFailed\":\"https://kb.arlo.com/000061944\"\r\n                    },\r\n                    \"videos\": {\r\n                      \"chimeType\": \"https://youtu.be/axytuF63VC0\",\r\n                      \"wireDoorbell\": \"https://youtu.be/_5D2n3iPqW0\",\r\n                      \"switchSetting\": \"https://youtu.be/BUmd4fik2RE\"\r\n                    },\r\n                    \"arloVideos\": {\r\n                      \"chimeType\": \"https://vzs3-prod-common.s3.amazonaws.com/static/devicesupport/Arlo_Audio_Doorbell_Chime.mp4\",\r\n                      \"wireDoorbell\": \"https://vzs3-prod-common.s3.amazonaws.com/static/devicesupport/Arlo_Audio_Doorbell_Wired.mp4\",\r\n                      \"switchSetting\": \"https://vzs3-prod-common.s3.amazonaws.com/static/devicesupport/Arlo_Audio_Doorbell_Switch.mp4\"\r\n                    }\r\n                  }\r\n              },\r\n              \"arlosmart\": {\r\n                  \"kbArticles\": {\r\n                    \"e911\": \"https://www.arlo.com/en-us/landing/arlosmart/\",\r\n                    \"callFriend\": \"https://www.arlo.com/en-us/landing/arlosmart/\",\r\n                    \"4kAddOnPopup\": \"https://www.arlo.com/en-us/landing/arlosmart/\",\r\n                    \"cloudRecording\": \"https://www.arlo.com/en-us/landing/arlosmart/\",\r\n                    \"manageArloSmart\": \"https://kb.arlo.com/000062115\",\r\n                    \"otherVideo\": \"https://kb.arlo.com/000062115\",\r\n                    \"packageDetection\": \"https://kb.arlo.com/000062114\",\r\n                    \"whereIsBasicSubscriptionGone\": \"https://kb.arlo.com/000062163\"\r\n                  }\r\n                }\r\n              },\r\n              \"success\":true\r\n            }\r\n            \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/devicesupport/v3')\r\n    \r\n        def GetDeviceCapabilities(self, device):\r\n            model = device.get('modelId').lower()\r\n            return self.request.get(f'https://{self.BASE_URL}/resources/capabilities/'+model+'/'+model+'_'+device.get('interfaceVersion')+'.json', raw=True)\r\n    \r\n        def GetLibraryMetaData(self, from_date, to_date):\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/library/metadata', {'dateFrom':from_date, 'dateTo':to_date})\r\n    \r\n        def UpdateProfile(self, first_name, last_name):\r\n            return self.request.put(f'https://{self.BASE_URL}/hmsweb/users/profile', {'firstName': first_name, 'lastName': last_name})\r\n    \r\n        def UpdatePassword(self, password):\r\n            r = self.request.post(f'https://{self.BASE_URL}/hmsweb/users/changePassword', {'currentPassword':self.password,'newPassword':password})\r\n            self.password = password\r\n            return r\r\n    \r\n        def UpdateFriend(self, body):\r\n            \"\"\"\r\n            This is an example of the json you would pass in the body:\r\n            {\r\n              \"firstName\":\"Some\",\r\n              \"lastName\":\"Body\",\r\n              \"devices\":{\r\n                \"XXXXXXXXXXXXX\":\"Camera 1\",\r\n                \"XXXXXXXXXXXXX\":\"Camera 2 \",\r\n                \"XXXXXXXXXXXXX\":\"Camera 3\"\r\n              },\r\n              \"lastModified\":1463977440911,\r\n              \"adminUser\":true,\r\n              \"email\":\"user@example.com\",\r\n              \"id\":\"XXX-XXXXXXX\"\r\n            }\r\n            \"\"\"\r\n            return self.request.put(f'https://{self.BASE_URL}/hmsweb/users/friends', body)\r\n    \r\n        def RemoveFriend(self, email):\r\n            \"\"\"\r\n            Removes a person you've granted access to.\r\n    \r\n            email: email of user you want to revoke access from.\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/friends/remove', {\"email\":email})\r\n    \r\n        def AddFriend(self, firstname, lastname, email, devices={}, admin=False):\r\n            \"\"\"\r\n            This API will send an email to a user and if they accept, will give them access to the devices you specify.\r\n            NOTE: XXX-XXXXXXX_XXXXXXXXXXXX is the uniqueId field in your device object.\r\n    \r\n            {adminUser:false,firstName:John,lastName:Doe,email:john.doe@example.com,devices:{XXX-XXXXXXX_XXXXXXXXXXXX:Camera1,XXX-XXXXXXX_XXXXXXXXXXXX:Camera2}}\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/friends', {\"adminUser\":admin,\"firstName\":firstname,\"lastName\":lastname,\"email\":email,\"devices\":devices})\r\n    \r\n        def ResendFriendInvite(self, friend):\r\n            \"\"\"\r\n            This API will resend an invitation email to a user that you've AddFriend'd. You will need to get the friend object by calling GetFriend() because it includes a token that must be passed to this API.\r\n            friend: {\"ownerId\":\"XXX-XXXXXXX\",\"token\":\"really long string that you get from the GetFriends() API\",\"firstName\":\"John\",\"lastName\":\"Doe\",\"devices\":{\"XXX-XXXXXXX_XXXXXXXXXXXX\":\"Camera1\",\"XXX-XXXXXXX_XXXXXXXXXXXX\":\"Camera2\"},\"lastModified\":1548470485419,\"adminUser\":false,\"email\":\"john.doe@example.com\"}\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/friends', friend)\r\n    \r\n        def UpdateDeviceName(self, device, name):\r\n            return self.request.put(f'https://{self.BASE_URL}/hmsweb/users/devices/renameDevice', {'deviceId':device.get('deviceId'), 'deviceName':name, 'parentId':device.get('parentId')})\r\n    \r\n        def UpdateDisplayOrder(self, body):\r\n            \"\"\"\r\n            This is an example of the json you would pass in the body to UpdateDisplayOrder() of your devices in the UI.\r\n    \r\n            XXXXXXXXXXXXX is the device id of each camera. You can get this from GetDevices().\r\n            {\r\n              \"devices\":{\r\n                \"XXXXXXXXXXXXX\":1,\r\n                \"XXXXXXXXXXXXX\":2,\r\n                \"XXXXXXXXXXXXX\":3\r\n              }\r\n            }\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/displayOrder', body)\r\n    \r\n        def GetLibrary(self, from_date, to_date):\r\n            \"\"\"\r\n            This call returns the following:\r\n            presignedContentUrl is a link to the actual video in Amazon AWS.\r\n            presignedThumbnailUrl is a link to the thumbnail .jpg of the actual video in Amazon AWS.\r\n    \r\n            [\r\n              {\r\n                \"mediaDurationSecond\": 30,\r\n                \"contentType\": \"video/mp4\",\r\n                \"name\": \"XXXXXXXXXXXXX\",\r\n                \"presignedContentUrl\": \"https://arlos3-prod-z2.s3.amazonaws.com/XXXXXXX_XXXX_XXXX_XXXX_XXXXXXXXXXXXX/XXX-XXXXXXX/XXXXXXXXXXXXX/recordings/XXXXXXXXXXXXX.mp4?AWSAccessKeyId=XXXXXXXXXXXXXXXXXXXX&Expires=1472968703&Signature=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\r\n                \"lastModified\": 1472881430181,\r\n                \"localCreatedDate\": XXXXXXXXXXXXX,\r\n                \"presignedThumbnailUrl\": \"https://arlos3-prod-z2.s3.amazonaws.com/XXXXXXX_XXXX_XXXX_XXXX_XXXXXXXXXXXXX/XXX-XXXXXXX/XXXXXXXXXXXXX/recordings/XXXXXXXXXXXXX_thumb.jpg?AWSAccessKeyId=XXXXXXXXXXXXXXXXXXXX&Expires=1472968703&Signature=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\r\n                \"reason\": \"motionRecord\",\r\n                \"deviceId\": \"XXXXXXXXXXXXX\",\r\n                \"createdBy\": \"XXXXXXXXXXXXX\",\r\n                \"createdDate\": \"20160903\",\r\n                \"timeZone\": \"America/Chicago\",\r\n                \"ownerId\": \"XXX-XXXXXXX\",\r\n                \"utcCreatedDate\": XXXXXXXXXXXXX,\r\n                \"currentState\": \"new\",\r\n                \"mediaDuration\": \"00:00:30\"\r\n              }\r\n            ]\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/library', {'dateFrom':from_date, 'dateTo':to_date})\r\n    \r\n        def DeleteRecording(self, recording):\r\n            \"\"\"\r\n            Delete a single video recording from Arlo.\r\n            All of the date info and device id you need to pass into this method are given in the results of the GetLibrary() call.\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/library/recycle', {'data':[{'createdDate':recording.get('createdDate'),'utcCreatedDate':recording.get('createdDate'),'deviceId':recording.get('deviceId')}]})\r\n    \r\n        def BatchDeleteRecordings(self, recordings):\r\n            \"\"\"\r\n            Delete a batch of video recordings from Arlo.\r\n    \r\n            The GetLibrary() call response json can be passed directly to this method if you'd like to delete the same list of videos you queried for.\r\n            If you want to delete some other batch of videos, then you need to send an array of objects representing each video you want to delete.\r\n    \r\n            [\r\n              {\r\n                \"createdDate\":\"20160904\",\r\n                \"utcCreatedDate\":1473010280395,\r\n                \"deviceId\":\"XXXXXXXXXXXXX\"\r\n              },\r\n              {\r\n                \"createdDate\":\"20160904\",\r\n                \"utcCreatedDate\":1473010280395,\r\n                \"deviceId\":\"XXXXXXXXXXXXX\"\r\n              }\r\n            ]\r\n            \"\"\"\r\n            if recordings:\r\n                return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/library/recycle', {'data':recordings})\r\n    \r\n        def GetRecording(self, url, chunk_size=4096):\r\n            \"\"\" Returns the whole video from the presignedContentUrl. \"\"\"\r\n            video = ''\r\n            r = requests.get(url, stream=True)\r\n            r.raise_for_status()\r\n    \r\n            for chunk in r.iter_content(chunk_size):\r\n                if chunk: video += chunk\r\n            return video\r\n    \r\n        def StreamRecording(self, url, chunk_size=4096):\r\n            \"\"\"\r\n            Returns a generator that is the chunked video stream from the presignedContentUrl.\r\n    \r\n            url: presignedContentUrl\r\n            \"\"\"\r\n            r = requests.get(url, stream=True)\r\n            r.raise_for_status()\r\n            for chunk in r.iter_content(chunk_size):\r\n                yield chunk\r\n    \r\n        def DownloadRecording(self, url, to):\r\n            \"\"\"\r\n            Writes a video to a given local file path.\r\n    \r\n            url: presignedContentUrl\r\n            to: path where the file should be written\r\n            \"\"\"\r\n            stream = self.StreamRecording(url)\r\n            with open(to, 'wb') as fd:\r\n                for chunk in stream:\r\n                    fd.write(chunk)\r\n            fd.close()\r\n    \r\n        def DownloadSnapshot(self, url, to, chunk_size=4096):\r\n            \"\"\"\r\n            Writes a snapshot to a given local file path.\r\n    \r\n            url: presignedContentUrl or presignedFullFrameSnapshotUrl\r\n            to: path where the file should be written\r\n            \"\"\"\r\n            r = Request().get(url, stream=True)\r\n            with open(to, 'wb') as fd:\r\n                for chunk in r.iter_content(chunk_size):\r\n                    fd.write(chunk)\r\n            fd.close()\r\n    \r\n        def StartStream(self, basestation, camera):\r\n            \"\"\"\r\n            This function returns the url of the rtsp video stream.\r\n            This stream needs to be called within 30 seconds or else it becomes invalid.\r\n            It can be streamed with: ffmpeg -re -i 'rtsps://<url>' -acodec copy -vcodec copy test.mp4\r\n            The request to /users/devices/startStream returns: { url:rtsp://<url>:443/vzmodulelive?egressToken=b<xx>&userAgent=iOS&cameraId=<camid>}\r\n            \"\"\"\r\n            # nonlocal variable hack for Python 2.x.\r\n            class nl:\r\n                stream_url_dict = None\r\n    \r\n            def trigger(self):\r\n                nl.stream_url_dict = self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/startStream', {\"to\":camera.get('parentId'),\"from\":self.user_id+\"_web\",\"resource\":\"cameras/\"+camera.get('deviceId'),\"action\":\"set\",\"responseUrl\":\"\", \"publishResponse\":True,\"transId\":self.genTransId(),\"properties\":{\"activityState\":\"startUserStream\",\"cameraId\":camera.get('deviceId')}}, headers={\"xcloudId\":camera.get('xCloudId')})\r\n    \r\n            def callback(self, event):\r\n                if event.get(\"from\") == basestation.get(\"deviceId\") and event.get(\"resource\") == \"cameras/\"+camera.get(\"deviceId\") and event.get(\"properties\", {}).get(\"activityState\") == \"userStreamActive\":\r\n                    return nl.stream_url_dict['url'].replace(\"rtsp://\", \"rtsps://\")\r\n    \r\n                return None\r\n    \r\n            return self.TriggerAndHandleEvent(basestation, trigger, callback)\r\n    \r\n        def StopStream(self, basestation, camera):\r\n    \r\n            # nonlocal variable hack for Python 2.x.\r\n            class nl:\r\n                stream_url_dict = None\r\n    \r\n            def trigger(self):\r\n                self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/stopStream', {\"to\":camera.get('parentId'),\"from\":self.user_id+\"_web\",\"resource\":\"cameras/\"+camera.         get('deviceId'),\"action\":\"set\",\"responseUrl\":\"\", \"publishResponse\":True,\"transId\":self.genTransId(),\"properties\":{\"activityState\":\"stopUserStream\",\"cameraId\":camera.get('deviceId')}}, headers={\"xcloudId\": camera.get('xCloudId')})\r\n    \r\n            def callback(self, event):\r\n                if event.get(\"from\") == basestation.get(\"deviceId\") and event.get(\"resource\") == \"cameras/\"+camera.get(\"deviceId\") and event.get(\"properties\", {}).get(\"activityState\") == \"userStreamActive\":\r\n                    return nl.stream_url_dict['url'].replace(\"rtsp://\", \"rtsps://\")\r\n                return None\r\n    \r\n            return self.TriggerAndHandleEvent(basestation, trigger, callback)\r\n    \r\n        def TriggerStreamSnapshot(self, basestation, camera):\r\n            \"\"\"\r\n            This function causes the camera to snapshot while recording.\r\n            NOTE: You MUST call StartStream() before calling this function.\r\n            If you call StartStream(), you have to start reading data from the stream, or streaming will be cancelled\r\n            and taking a snapshot may fail (since it requires the stream to be active).\r\n    \r\n            NOTE: You should not use this function is you just want a snapshot and aren't intending to stream.\r\n            Use TriggerFullFrameSnapshot() instead.\r\n    \r\n            NOTE: Use DownloadSnapshot() to download the actual image file.\r\n            \"\"\"\r\n            def trigger(self):\r\n                self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/takeSnapshot', {'xcloudId':camera.get('xCloudId'),'parentId':camera.get('parentId'),'deviceId':camera.get('deviceId'),'olsonTimeZone':camera.get('properties', {}).get('olsonTimeZone')}, headers={\"xcloudId\":camera.get('xCloudId')})\r\n    \r\n            def callback(self, event):\r\n                if event.get(\"deviceId\") == camera.get(\"deviceId\") and event.get(\"resource\") == \"mediaUploadNotification\":\r\n                    presigned_content_url = event.get(\"presignedContentUrl\")\r\n                    if presigned_content_url is not None:\r\n                        return presigned_content_url\r\n    \r\n                return None\r\n    \r\n            return self.TriggerAndHandleEvent(basestation, trigger, callback)\r\n    \r\n        def TriggerFullFrameSnapshot(self, basestation, camera):\r\n            \"\"\"\r\n            This function causes the camera to record a fullframe snapshot.\r\n            The presignedFullFrameSnapshotUrl url is returned.\r\n            Use DownloadSnapshot() to download the actual image file.\r\n            \"\"\"\r\n            def trigger(self):\r\n                self.request.post(\"https://my.arlo.com/hmsweb/users/devices/fullFrameSnapshot\", {\"to\":camera.get(\"parentId\"),\"from\":self.user_id+\"_web\",\"resource\":\"cameras/\"+camera.get(\"deviceId\"),\"action\":\"set\",\"publishResponse\":True,\"transId\":self.genTransId(),\"properties\":{\"activityState\":\"fullFrameSnapshot\"}}, headers={\"xcloudId\":camera.get(\"xCloudId\")})\r\n    \r\n            def callback(self, event):\r\n                if event.get(\"from\") == basestation.get(\"deviceId\") and event.get(\"resource\") == \"cameras/\"+camera.get(\"deviceId\") and event.get(\"action\") == \"fullFrameSnapshotAvailable\":\r\n                    return event.get(\"properties\", {}).get(\"presignedFullFrameSnapshotUrl\")\r\n                return None\r\n    \r\n            return self.TriggerAndHandleEvent(basestation, trigger, callback)\r\n    \r\n        def StartRecording(self, basestation, camera):\r\n            \"\"\"\r\n            This function causes the camera to start recording.\r\n            You can get the timezone from GetDevices().\r\n            \"\"\"\r\n            stream_url = self.StartStream(basestation, camera)\r\n            self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/startRecord', {'xcloudId':camera.get('xCloudId'),'parentId':camera.get('parentId'),'deviceId':camera.get('deviceId'),'olsonTimeZone':camera.get('properties', {}).get('olsonTimeZone')}, headers={\"xcloudId\":camera.get('xCloudId')})\r\n            return stream_url\r\n    \r\n        def StopRecording(self, camera):\r\n            \"\"\"\r\n            This function causes the camera to stop recording.\r\n            You can get the timezone from GetDevices().\r\n            \"\"\"\r\n            return self.request.post(f'https://{self.BASE_URL}/hmsweb/users/devices/stopRecord', {'xcloudId':camera.get('xCloudId'),'parentId':camera.get('parentId'),'deviceId':camera.get('deviceId'),'olsonTimeZone':camera.get('properties', {}).get('olsonTimeZone')}, headers={\"xcloudId\":camera.get('xCloudId')})\r\n    \r\n        def GetCvrPlaylist(self, camera, fromDate, toDate):\r\n            \"\"\" This function downloads a Cvr Playlist file for the period fromDate to toDate. \"\"\"\r\n            return self.request.get(f'https://{self.BASE_URL}/hmsweb/users/devices/'+camera.get('deviceId')+'/playlist?fromDate='+fromDate+'&toDate='+toDate)\r\n    \r\n    \r\n    ### ARLO DOWNLOAD SCRIPT ###\r\n    \r\n    from datetime import timedelta, date\r\n    import datetime\r\n    import sys\r\n    \r\n    import os\r\n    import json\r\n    import keyring\r\n    from office365.sharepoint.client_context import ClientContext\r\n    from office365.runtime.auth.user_credential import UserCredential\r\n    from office365.runtime.http.request_options import RequestOptions\r\n    \r\n    USERNAME = \"deonarlo1@gmail.com\"\r\n    PASSWORD = \"@DeonArlo4269\"\r\n    \r\n    devices = {\r\n        '51C2917HA0239': 'Arlo1',\r\n        '51C2917KA005D': 'Arlo2',\r\n        '51C2917BA04D9': 'Arlo3',\r\n        '51C2917JA0191': 'Arlo4',\r\n    }\r\n    \r\n    try:\r\n        arlo = Arlo(USERNAME, PASSWORD, 'gmail.credentials') # Log in\r\n        #print(\"Logged in...\")\r\n        cameras = arlo.GetDevices('camera')\r\n        today = (date.today()-timedelta(days=0)).strftime(\"%Y%m%d\")\r\n        seven_days_ago = (date.today()-timedelta(days=7)).strftime(\"%Y%m%d\")\r\n    \r\n        # Get all of the recordings for a date range.\r\n        library = arlo.GetLibrary(seven_days_ago, today)\r\n    \r\n        #if not os.path.exists(os.getcwd() + \"\\\\videos\"):\r\n        #    os.makedirs(os.getcwd() + \"\\\\videos\")\r\n        \r\n        # Iterate through the recordings in the library.\r\n        for recording in library:\r\n            videofilename = devices[recording['deviceId']] + '_' + datetime.datetime.fromtimestamp(int(recording['name'])//1000).strftime('%Y-%m-%d %H-%M-%S') + '.mp4'\r\n    \r\n            stream = arlo.StreamRecording(recording['presignedContentUrl'])\r\n            with open('C:/Users/svcrpabot/OneDrive - SA Power Networks/Arlo/videos/'+videofilename, 'wb') as f:\r\n                for chunk in stream:\r\n                    f.write(chunk)\r\n                f.close()\r\n    \r\n            #print('Downloaded video '+videofilename+' from '+recording['createdDate']+'.')\r\n    \r\n    except Exception as e:\r\n        result = (\"Download\", e)\r\n        #print(\"Download\", e)\r\n    \r\n    site = \"https://sapowernetworks.sharepoint.com/sites/ComplianceManagement/\"\r\n    ctx = ClientContext(site).with_credentials(UserCredential(rpaAPIuser, rpaAPIpass))\r\n    \r\n    req = RequestOptions(\"{0}/_api/web/\".format(site))\r\n    response = ctx.execute_request_direct(req)\r\n    json = json.loads(response.content)\r\n    web_title = json['d']['Title']\r\n    #print(\"Web title: {0}\".format(web_title))\r\n    \r\n    in_path = \"C:/Users/svcrpabot/OneDrive - SA Power Networks/Arlo/videos/\" #os.getcwd() + \"\\\\videos\"\r\n    for vid_path in os.listdir(in_path):\r\n        video = os.path.join(in_path, vid_path)\r\n        with open(video, 'rb') as content:\r\n            file_content = content.read()\r\n    \r\n        # list_title = \"Arlo Videos/\" + vid_path[:5] + \"/\" + vid_path[6:15]\r\n        list_title = \"Arlo Videos\"\r\n        target_folder_url = \"/Arlo Videos/\" + vid_path[:5] + \"/\" + vid_path[6:16]\r\n        target_folder_url = ctx.web.ensure_folder_path(target_folder_url).execute_query()\r\n        target_folder = ctx.web.get_folder_by_server_relative_url(\"Arlo Videos/\" + vid_path[:5] + \"/\" + vid_path[6:16])\r\n        target_file = target_folder.upload_file(vid_path, file_content).execute_query()\r\n        #print(\"File has been uploaded to url: {0}\".format(target_file.serverRelativeUrl))\r\n        os.remove(\"videos/\" + vid_path)"
  results:
    - SUCCESS
