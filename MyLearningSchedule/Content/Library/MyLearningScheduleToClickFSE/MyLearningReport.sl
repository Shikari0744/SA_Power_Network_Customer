namespace: MyLearningScheduleToClickFSE
operation:
  name: MyLearningReport
  inputs:
    - fileName
  python_action:
    use_jython: false
    script: "def execute(fileName): \r\n    from datetime import datetime \r\n    from base64 import b64encode\r\n    from openpyxl import load_workbook\r\n    import pandas as pd    \r\n    from calendar import monthrange\r\n    \r\n    pd_xl_file = pd.ExcelFile(fileName)\r\n    df = pd_xl_file.parse(\"Sheet 1\")\r\n    count = df.shape\r\n    rowCount = count[0] + 3\r\n    \r\n    wb = load_workbook(filename=fileName,read_only=False)\r\n    ws = wb.active\r\n    \r\n    complete = \"Not complete\"\r\n    \r\n    for emp in range(1,rowCount):\r\n        updatedCheck = ws[\"T\"+str(emp)].value\r\n        if updatedCheck == None:\r\n            personnelNo = ws[\"C\"+str(emp)].value\r\n            if personnelNo == None:\r\n                complete = \"Completed\"\r\n                break\r\n            courseTitle = ws[\"J\"+str(emp)].value\r\n            courseLocation = ws[\"O\"+str(emp)].value\r\n            courseStartTime = ws[\"G\"+str(emp)].value\r\n            courseFinishTime = ws[\"H\"+str(emp)].value\r\n            courseInfo = courseLocation + \" / \" + str(courseStartTime) + \"-\" + str(courseFinishTime) + \" / \" + courseTitle\r\n            startDate = ws[\"K\"+str(emp)].value\r\n            startDate = startDate.strftime(\"%Y-%m-%d %H:%M:%S\")\r\n            startDate,x = startDate.split()\r\n            finishDate = ws[\"L\"+str(emp)].value\r\n            finishDate = finishDate.strftime(\"%Y-%m-%d %H:%M:%S\")\r\n            finishDate,y = finishDate.split()\r\n            startTime = ws[\"G\"+str(emp)].value\r\n            startTime = startTime.strftime(\"%H:%M:%S\")\r\n            finishTime = ws[\"H\"+str(emp)].value\r\n            finishTime = finishTime.strftime(\"%H:%M:%S\")\r\n            employeeDepot = ws[\"F\"+str(emp)].value\r\n            trainingDepot = ws[\"O\"+str(emp)].value\r\n            break\r\n    wb.save(fileName)\r\n    wb.close()\r\n    \r\n    if complete == \"Completed\":\r\n        return{\"complete\":complete}\r\n    else:\r\n        trainingDates = []\r\n        if startDate != finishDate:\r\n            startD = datetime.strptime(startDate, \"%Y-%m-%d\")\r\n            startYear = startD.strftime(\"%Y\")\r\n            startMonth = startD.strftime(\"%m\")\r\n            startDay = startD.strftime(\"%d\")\r\n        \r\n            finishD = datetime.strptime(finishDate, \"%Y-%m-%d\")\r\n            finishYear = finishD.strftime(\"%Y\")\r\n            finishMonth = finishD.strftime(\"%m\")\r\n            finishDay = finishD.strftime(\"%d\")    \r\n        \r\n            num_days = monthrange(int(startYear), int(startMonth))[1] \r\n        \r\n            if startMonth != finishMonth:\r\n                i = int(startMonth)\r\n                finishMonth = int(finishMonth)\r\n                loop = 1\r\n                while i <= finishMonth:\r\n                    if loop == 2:\r\n                        startDay = 1\r\n                    startDate = startYear+\"-\"+str(i)+\"-\"+str(startDay)\r\n                    finishDate = startYear+\"-\"+str(i)+\"-\"+str(finishDay)\r\n                    if startDay != finishDay:\r\n                        o = int(startDay)\r\n                        finishDay = int(finishDay)\r\n                        while o <= finishDay:\r\n                                startDate = startYear+\"-\"+str(i)+\"-\"+str(o)\r\n                                startDate = startDate+\"T\"+startTime\r\n                                finishDate = startYear+\"-\"+str(i)+\"-\"+str(o)\r\n                                finishDate = finishDate+\"T\"+finishTime\r\n                                newStartdate = startDate+\"/\"+finishDate\r\n                                trainingDates.append(newStartdate)\r\n                                o += 1\r\n                                if o > finishDay:\r\n                                    o = 100\r\n                        if o > num_days:\r\n                                    break\r\n                        if o > finishDay:\r\n                            startDate = startYear+\"-\"+str(i)+\"-\"+str(o)\r\n                            startDate = startDate+\"T\"+startTime\r\n                            finishDate = startYear+\"-\"+str(i)+\"-\"+str(o)\r\n                            finishDate = finishDate+\"T\"+finishTime\r\n                            newStartdate = startDate+\"/\"+finishDate\r\n                            trainingDates.append(newStartdate)\r\n                            o += 1   \r\n                            p = int(startDay) + 1\r\n                            finishDay = int(finishDay)                    \r\n                            while p > finishDay:              \r\n                                startDate = startYear+\"-\"+str(i)+\"-\"+str(p)\r\n                                startDate = startDate+\"T\"+startTime\r\n                                finishDate = startYear+\"-\"+str(i)+\"-\"+str(p)\r\n                                finishDate = finishDate+\"T\"+finishTime\r\n                                newStartdate = startDate+\"/\"+finishDate\r\n                                trainingDates.append(newStartdate)\r\n                                p += 1\r\n                                if p > num_days:\r\n                                    o = 0\r\n                                    break\r\n                    else: \r\n                        startDate = startYear+\"-\"+str(i)+\"-\"+str(startDay)\r\n                        startDate = startDate+\"T\"+startTime\r\n                        finishDate = startYear+\"-\"+str(i)+\"-\"+str(finishDay)\r\n                        finishDate = finishDate+\"T\"+finishTime\r\n                        newStartdate = startDate+\"/\"+finishDate\r\n                        trainingDates.append(newStartdate)                \r\n                    loop = 2\r\n                    i += 1 \r\n            else:\r\n                if startDay != finishDay:\r\n                    i = int(startDay)\r\n                    finishDay = int(finishDay)\r\n                    while i <= finishDay:\r\n                        startDate = startYear+\"-\"+startMonth+\"-\"+str(i)\r\n                        startDate = startDate+\"T\"+startTime\r\n                        finishDate = startYear+\"-\"+startMonth+\"-\"+str(i)\r\n                        finishDate = finishDate+\"T\"+finishTime\r\n                        newStartdate = startDate+\"/\"+finishDate\r\n                        trainingDates.append(newStartdate)\r\n                        i += 1      \r\n        else:\r\n            startDate = startDate+\"T\"+startTime\r\n            finishDate = finishDate+\"T\"+finishTime\r\n            newStartdate = startDate+\"/\"+finishDate\r\n            trainingDates.append(newStartdate)\r\n        \r\n        trainingTimes = \"\"\r\n        for x in trainingDates:\r\n            training = x\r\n            trainingTimes = trainingTimes +\",\" +training\r\n        trainingTimes = trainingTimes.replace(\",\",\"\",1)\r\n    \r\n        return{\"currentRow\":emp,\"complete\":complete,\"personnelNo\":personnelNo,\"courseInfo\":courseInfo,\"trainingTimes\":trainingTimes,\"employeeDepot\":employeeDepot,\"trainingDepot\":trainingDepot}"
  outputs:
    - personnelNo
    - courseInfo
    - trainingTimes
    - employeeDepot
    - trainingDepot
    - complete
    - currentRow
  results:
    - SUCCESS
