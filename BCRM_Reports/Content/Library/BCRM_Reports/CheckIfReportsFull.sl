namespace: BCRM_Reports
operation:
  name: CheckIfReportsFull
  inputs:
    - formattedFilesFolder
  python_action:
    use_jython: false
    script: "def execute(formattedFilesFolder):\r\n    from openpyxl import load_workbook\r\n    import os\r\n    \r\n    failure = \"\"\r\n    basicEstimates = \"\"\r\n    intervalEstimates = \"\"\r\n    basicNulls = \"\"\r\n    intervalNulls = \"\"    \r\n    \r\n    reports = os.listdir(formattedFilesFolder)\r\n    for report in reports:\r\n        workbook = load_workbook(filename=formattedFilesFolder+report,read_only=True)\r\n        sheets = workbook.sheetnames\r\n        if \"BASIC-ESTIMATES\" in report:\r\n            columnOrder = \"NMI,SFX,START_DTE,END_DTE,FRMP,LR,MDP,FLAG,KWH,SeqNo,COMMENTS,ACTIONED_BY,DATE_ACTIONED,,\"\r\n        elif \"INTERVAL-ESTIMATES\" in report:\r\n            columnOrder = \"NMI,Checksum,SFX,SettDate,FRMP,LR,MDP,FLAG,METER TYPE,SeqNo,COMMENTS,ACTIONED_BY,DATE_ACTIONED,,\"\r\n        elif \"BASIC-NULLS\" in report:\r\n            columnOrder = \"NMI,START_DATE,END_DATE,ABCON,INTERVAL,EARLIEST_REVISION,LATEST_REVISION,COMMENTS,ACTIONED_BY,DATE_ACTIONED,R_DATE,R_DATE,SUFFIX,TXTNUMDAYS,TXT_CSUM\"\r\n        elif \"INTERVAL-NULLS\" in report:\r\n            columnOrder = \"NMI,START_DATE,END_DATE,SUFFIX,COMMENTS,ACTIONED_BY,DATE_ACTIONED,,,,,,,,\"                \r\n        for sheet in sheets:\r\n            if sheet != \"Sheet1\":\r\n                worksheet = workbook[sheet]\r\n                columnA = worksheet[\"A1\"].value\r\n                columnB = worksheet[\"B1\"].value\r\n                columnC = worksheet[\"C1\"].value\r\n                columnD = worksheet[\"D1\"].value\r\n                columnE = worksheet[\"E1\"].value\r\n                columnF = worksheet[\"F1\"].value\r\n                if columnF == None:\r\n                    columnF = \"\"               \r\n                columnG = worksheet[\"G1\"].value\r\n                if columnG == None:\r\n                    columnG = \"\"               \r\n                columnH = worksheet[\"H1\"].value\r\n                if columnH == None:\r\n                    columnH = \"\"               \r\n                columnI = worksheet[\"I1\"].value\r\n                if columnI == None:\r\n                    columnI = \"\"               \r\n                columnJ = worksheet[\"J1\"].value\r\n                if columnJ == None:\r\n                    columnJ = \"\"               \r\n                columnK = worksheet[\"K1\"].value\r\n                if columnK == None:\r\n                    columnK = \"\"               \r\n                columnL = worksheet[\"L1\"].value\r\n                if columnL == None:\r\n                    columnL = \"\"               \r\n                columnM = worksheet[\"M1\"].value\r\n                if columnM == None:\r\n                    columnM = \"\"        \r\n                columnN = worksheet[\"N1\"].value\r\n                if columnN == None:\r\n                    columnN = \"\"        \r\n                columnO = worksheet[\"O1\"].value\r\n                if columnO == None:\r\n                    columnO = \"\"\r\n                reportColumn = columnA +\",\"+ columnB +\",\"+ columnC +\",\"+ columnD +\",\"+ columnE +\",\"+ columnF +\",\"+ columnG +\",\"+ columnH +\",\"+ columnI +\",\"+ columnJ +\",\"+ columnK +\",\"+ columnL +\",\"+ columnM +\",\"+ columnN +\",\"+ columnO \r\n                if reportColumn != columnOrder:\r\n                    if \"BASIC-ESTIMATES\" in report:\r\n                        basicEstimates = \"Column Headings do not match expected order\"\r\n                        failure = \"fails found\"\r\n                    elif \"INTERVAL-ESTIMATES\" in report:\r\n                        intervalEstimates = \"Column Headings do not match expected order\"\r\n                        failure = \"fails found\"\r\n                    elif \"BASIC-NULLS\" in report:\r\n                        basicNulls = \"Column Headings do not match expected order\"\r\n                        failure = \"fails found\"\r\n                    elif \"INTERVAL-NULLS\" in report:\r\n                        intervalNulls = \"Column Headings do not match expected order\"\r\n                        failure = \"fails found\"\r\n        workbook.close()\r\n        \r\n    return{\"basicEstimates\":basicEstimates,\"intervalEstimates\":intervalEstimates,\"basicNulls\":basicNulls,\"intervalNulls\":intervalNulls,\"failure\":failure}"
  outputs:
    - basicEstimates
    - intervalEstimates
    - basicNulls
    - intervalNulls
    - failure
  results:
    - FAILURE: '${failure != ""}'
    - SUCCESS
